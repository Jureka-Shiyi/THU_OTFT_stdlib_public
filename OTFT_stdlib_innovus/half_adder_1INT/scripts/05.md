这个错误 **IMPSP-372** 是在 `03_place` 或 `sroute` 过程中非常常见的警告/错误。对于你这种 **900μm 高度的 OTFT 单元**，这通常意味着物理层面的**电源轨（Power Rail）与行（Row）没有完美对齐**。

### 1. 为什么会报错？

Innovus 在放置单元时，期望单元底部的电源管脚（Pin）正好落在它自动生成的 `FollowPin`（电源导轨）上。

* **原因 A：** 你在 `01_floorplan.tcl` 中定义的 `core` 起始坐标（）和 `Row` 的起始位置，与你在 `02_pg_stripe.tcl` 中手动 `addStripe` 的 M1 位置不重合。
* **原因 B：** OTFT 单元的 LEF 定义中，电源 Pin 的位置可能不在单元的最边缘（比如在  而不是 ），导致工具认为“Pin 没对上轨”。

### 2. 对 OTFT 工艺的影响

由于 OTFT 单元巨大且只有两层金属：

* 如果忽略此报错强制执行，可能会导致单元的电源管脚与打好的 M1 Stripe 之间存在**物理断路**或 **DRC 间距违例**。
* Innovus 警告说“可能会导致非法放置”，是因为它无法通过“靠在轨道上”来确定单元的合法 Y 坐标。

---

### 3. 彻底修复方案

#### 方案一：使用 `sroute` 自动生成轨道（最推荐）

不要手动用 `addStripe` 去画 M1。让 Innovus 根据 `Row` 的位置自动生成。

1. 删除 `02_pg_stripe.tcl` 中关于 **M1 Horizontal** 的 `addStripe` 代码。
2. 改用以下命令：

```tcl
# 自动在每一行 Row 的边界生成 FollowPin (电源轨)
# 它会根据 Row 的实际位置自动对齐，绝不会出现 mismatched
sroute -connect { corePin } -layerChangeRange { M1 M2 }

```

#### 方案二：手动校准 Floorplan 起点

如果你必须使用 `addStripe`，请检查 `01_floorplan.tcl`：

* 如果 `floorPlan ... -s $w $h 180 180 180 180`，说明 Row 从  开始。
* 那么你的 `addStripe` 的 `-start_offset` 必须计算得极其精确：
* 第一条线中心 = 
* 如果 Stripe 宽 30，offset 应该是 （中心对齐）或 （边缘对齐，取决于模式）。



---

### 4. 针对 05_route 的后续修正建议

即使通过了放置，你提供的 `05_route` 脚本还需要针对 **IMPSP-372** 引发的潜在问题做最后加固。请在执行 `routeDesign` 前加入以下指令：

```tcl

# 针对只有 M1/M2 的 OTFT：
# 强制开启交叉层连接，因为 M1 几乎被电源轨占满，信号线几乎只能走 M2
setNanoRouteMode -quiet -routeBottomRoutingLayer "M1"
setNanoRouteMode -quiet -routeTopRoutingLayer "M2"

# 极低频 2kHz：关闭所有时序冗余检查，防止工具因为误报的 DRC 停止布线
setNanoRouteMode -quiet -drouteAutoStop false
setNanoRouteMode -quiet -drouteEndIteration 20

# 执行布线
routeDesign -globalDetail

```

### 5. 检查项

请你在 Innovus 命令行输入以下命令并告诉我结果：
`dbGet head.coreSite.size`
以及
`dbGet [dbGet -p head.libCells.name <你的单元名>].size`

如果 **Site 的高度** 和 **单元的高度** 不匹配（哪怕差 0.001），也会报这个错。对于 900μm 的 OTFT，这通常是浮点数取整引起的。


从日志输出看，虽然报了 **ERROR (IMPSP-372)**，但 Innovus 最终还是成功插入了 130 个 Filler。这个报错在 OTFT 这种大尺寸工艺中非常具有代表性。

### 1. 深度解析：为什么在 addFiller 时报错？

这个错误的本质是 **“电源连接性校验失败”**。

* **原因**：Innovus 的 `addFiller` 会检查单元的电源引脚（Pin）是否能对准当前行（Row）定义的电源轨道（FollowPin）。
* **OTFT 的特殊性**：由于你的单元高度高达 900μm，如果在 LEF 文件中，Filler 单元的 `VDD/VSS` 引脚坐标与标准单元（Standard Cell）的引脚坐标哪怕有 **0.001μm** 的浮点数偏差，或者 Filler 单元没有正确继承 `CLASS CORE` 属性，工具就会认为“轨道不匹配”。
* **“Switching off DRC check”**：工具因为对不齐，放弃了自动避让电源短路的检查，这可能导致 Filler 虽然塞进去了，但 M1 层可能存在微小的断路或短路。

### 2. 这个错误致命吗？

**在 2kHz 的 OTFT 工艺下，通常不致命，但必须验证。**
因为你是在 **Post-Route**（布线后）阶段运行的 `addFiller`（见警告 IMPSP-5217），此时信号线已经布好。Filler 的插入主要是为了填充空隙以满足密度要求或完善电源轨。

### 3. 接下来的关键操作

为了确保这个 `mismatched FollowPin` 没有造成物理短路，你必须执行以下三步：

#### A. 修复连接性（针对 Filler 新增的 Pin）

日志显示新增了 130 个连接。虽然工具说连上了，但建议手动跑一次 `sroute` 来确保 Filler 的电源 Pin 真正吸附到 M1 Stripe 上：

```tcl
# 补全 Filler 单元的电源连接
sroute -connect { corePin } -layerChangeRange { M1 M1 }

```

#### B. 强制执行 ECO Route

正如警告 **IMPSP-5217** 所建议的，布线后加 Filler 必须进行局部布线修正，以修复可能被 Filler 挤占或遮挡的路径：

```tcl
# 针对 Filler 引入的潜在冲突进行局部修复
ecoRoute -target

```

#### C. 最终物理验证（最关键）

由于工具关闭了 DRC 检查，你必须手动启动最严格的验证：

```tcl
# 1. 检查断路/短路
verifyConnectivity -noAntenna -error 1000

# 2. 检查 M1/M2 间距（重点看 Filler 边缘）
verify_drc -limit 1000

```

---

### 4. 针对 OTFT 的底层建议

如果你发现 `verify_drc` 在 Filler 处有大量错误，说明你的 **Filler LEF 定义** 可能有问题。

* **检查建议**：打开 Filler 的 LEF 文件，对比它和普通逻辑单元（如 DFF）的 `SIZE` 和 `PIN VDD/VSS` 的  轴坐标。
* **坐标对齐**：对于 900μm 的高度，如果 VDD 在 DFF 里是 `RECT 0 885 1000 900`，那么在 Filler 里也必须**完全一致**。

### 5. 总结你的脚本进度

你现在已经完成了：

1. **PG Stripe** (M1/M2)
2. **Placement**
3. **CTS** (2kHz)
4. **Route**
5. **Filler** (正在进行)

**接下来的下一步建议：**
加完 Filler 并通过 `ecoRoute` 后，你的版图物理部分就基本完成了。
**你需要我帮你写最后的“数据导出与报告生成”脚本吗？** 包括生成 `final_report.txt`（包含时序、功耗、面积）和导出 GDSII 格式。


从你的 `verifyConnectivity` 报告来看，目前版图存在 **Open（开路/断路）** 问题，主要集中在两个方面：**信号线未连接到 Pin（IMPVFC-96）** 以及 **电源/地（Special Wires）网络断裂（IMPVFC-200/92）**。

在 OTFT 工艺中，这通常是因为 M1 层被电源轨（FollowPin/Stripe）占满，导致布线器（Router）无法在 M1 找到足够的空位来打 Via 连接到引脚。

---

### 1. 错误深度解析

* **IMPVFC-96 (Terminals not connected):**
意味着有两个标准单元的引脚（例如 DFF 的 D 或 Q）完全没连上信号线。
* **原因：** 可能是因为引脚被上方的 M1 电源轨完全遮盖，工具找不到打过孔（Via）的地方。


* **IMPVFC-200/92 (Net pieces not connected):**
意味着 VDD 或 VSS 在物理上断开了，或者某些 Filler/Cell 的电源 Pin 没能吸附到主电源轨上。
* **原因：** 这与你之前的 `mismatched FollowPin` 报错直接相关。因为轨道没对齐，`sroute` 可能跳过了一些单元。



---

### 2. 针对性的修复方案 (按顺序执行)

请在命令行按顺序输入以下指令尝试修复：

#### 第一步：强制修复引脚连接 (解决 IMPVFC-96)

我们要告诉工具，即使空间拥挤，也要强制通过 Via 跳到 M2 来连接 Pin。

```tcl
# 重新设置布线模式：强化 Pin 访问
setNanoRouteMode -quiet -routeWithViasOnlyForStandardCellPin true
# 增加详细布线迭代次数
setNanoRouteMode -quiet -drouteEndIteration 20
# 执行局部 ECO 布线来填补断路
ecoRoute -target

```

#### 第二步：补全电源连接 (解决 IMPVFC-200/92)

既然 Filler 和标准单元报了断路，我们需要重新跑一次针对 Pin 的电源布线：

```tcl
# 确保所有 corePin (VDD/VSS) 都强制连接到横向轨道上
sroute -connect { corePin } \
       -allowLayerChange 1 \
       -layerChangeRange { M1 M2 } \
       -blockPin useLef \
       -targetViaLayerRange { M1 M2 }

```

#### 第三步：检查手动 Stripe 引起的冲突

如果在 OTFT 中，你的 M1 Stripe 太宽，可能会完全盖住 Pin。

* **检查：** 放大报错的地方，看看是不是信号线尝试连接 Pin 时，被蓝色的电源线（M1）挡住了，且周围没有空间打 Via。
* **修复：** 如果 ecoRoute 失败，你可能需要手动在那个位置稍微缩短一下 Stripe 的长度（较危险），或者在 `01_floorplan` 阶段增大单元的 **Halo** 间距。

---

### 3. 终极验证 (确认修复结果)

修复后，请再次运行验证。如果数值变为 0，则说明物理连接已完成。

```tcl
# 重新验证连接性
verifyConnectivity -noAntenna

# 检查是否有短路 (Short)
verify_drc -limit 1000

```

---

### 总结与下一步建议

如果上述命令执行后仍然存在断路，说明你的 **M1 电源轨（Stripe）密度太高**，或者 **Cell 与 Row 确实没有对齐**（IMPSP-372 的后遗症）。

**你可以尝试告诉我：**
你的电源 Stripe（M1）的宽度和间距是多少？对于 900μm 高的单元，如果 M1 Stripe 铺得太密，信号线几乎没有生存空间。

**下一步：**
如果连接性修复到 0，我将为你提供 **06_export.tcl** 脚本，帮助你导出用于流片的 GDSII 文件和最终的时序报告。**需要我现在为你准备导出脚本吗？**


