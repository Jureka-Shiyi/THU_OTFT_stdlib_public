
#ENCRYPT
//
//  model: 114  target: nearbody2  profile: ultra layers: base,XCALIBRATE__M1,XCALIBRATE__M2
//
CAPACITANCE NEARBODY XCALIBRATE__M1 XCALIBRATE__M2 INSIDE OF XCALIBRATE__M2 MASK
[
    PROPERTY C
    max_caldistance = 1202.5 // For reference
    min_calwidth = 12 // For reference
    min_caldistance1 = 8 // For reference
    min_caldistance2 = 8 // For reference
    max_distance = (MAXDISTANCE_XCALIBRATE__M1 + MAXDISTANCE_XCALIBRATE__M2) / 2
    max_width = (MAXWIDTH_XCALIBRATE__M1 + MAXWIDTH_XCALIBRATE__M2) / 2
    scaleunits = 1e-15/1e-15
    profile = ultra_profileid
    model = 114
	current_distance = distance()
	current_distance2 = distance2()
	current_width1 = width1()
	current_width2 = width2()
	current_length = length()
	corner = corner_index()
    if (current_distance2 <= 0.0) {
    	act_delta1 = lookup1 (delta_tbl(),layer1(), corner, current_width1, max_caldistance)
    	act_delta2 = lookup1 (delta_tbl(),layer2(), corner, current_width2, max_caldistance)
    } else {
    	act_delta1 = lookup1 (delta_tbl(),layer1(), corner, current_width1, current_distance2)
	real_distance3 = current_distance + distance3()
    	act_delta2 = lookup1 (delta_tbl(),layer2(), corner, current_width2, real_distance3)
    }
    act_width1 = current_width1 + act_delta1
    act_width2 = current_width2 + act_delta2
    act_width = 2 * act_width1 * act_width2 / (act_width1 + act_width2)
    act_distance = current_distance - 0.5 * (act_delta1 + act_delta2)
    act_distance2 = current_distance2 - act_delta1
    min_caldistance = min_caldistance1
    if (min_caldistance2 < min_caldistance) {
    	min_caldistance = min_caldistance2
    }
    if (act_distance2 < min_caldistance) {
	act_distance2 = min_caldistance
    }
    if (act_distance < min_caldistance) {
	act_distance = min_caldistance
    }
    if (act_width < min_calwidth) {
	act_width = min_calwidth
    }
    C = 0.0
    new_max_caldist =  2.5 *  max_caldistance
    if (current_distance2 > 0.0) {
        C = current_length * (0.0237181 * exp(-0.000823037*act_distance) / pow(act_distance,0.481479)) * pow(act_width,0.0632942) * pow(act_distance2,0.178406)
    }
    if (current_distance2 <= 0.0) {
        C = current_length * (0.0237181 * exp(-0.000823037*act_distance) / pow(act_distance,0.481479)) * pow(act_width,0.0632942) * pow(new_max_caldist,0.178406)
    }
    if ((distance2_behind() > 0.0) && (distance2_behind() < max_distance) && (current_distance2 > 0) && (current_distance2 < current_distance)) {
	C = 0
    } 
    C = C * scaleunits
]
CAPACITANCE NEARBODY XCALIBRATE__M2 XCALIBRATE__M1 INSIDE OF XCALIBRATE__M1 MASK
[
    PROPERTY C
    max_caldistance = 1202.5 // For reference
    min_calwidth = 12 // For reference
    min_caldistance1 = 8 // For reference
    min_caldistance2 = 8 // For reference
    max_distance = (MAXDISTANCE_XCALIBRATE__M1 + MAXDISTANCE_XCALIBRATE__M2) / 2
    max_width = (MAXWIDTH_XCALIBRATE__M1 + MAXWIDTH_XCALIBRATE__M2) / 2
    scaleunits = 1e-15/1e-15
    profile = ultra_profileid
    model = 114
	current_distance = distance()
	current_distance2 = distance2()
	current_width1 = width1()
	current_width2 = width2()
	current_length = length()
	corner = corner_index()
    if (current_distance2 <= 0.0) {
    	act_delta1 = lookup1 (delta_tbl(),layer1(), corner, current_width1, max_caldistance)
    	act_delta2 = lookup1 (delta_tbl(),layer2(), corner, current_width2, max_caldistance)
    } else {
    	act_delta1 = lookup1 (delta_tbl(),layer1(), corner, current_width1, current_distance2)
	real_distance3 = current_distance + distance3()
    	act_delta2 = lookup1 (delta_tbl(),layer2(), corner, current_width2, real_distance3)
    }
    act_width1 = current_width1 + act_delta1
    act_width2 = current_width2 + act_delta2
    act_width = 2 * act_width1 * act_width2 / (act_width1 + act_width2)
    act_distance = current_distance - 0.5 * (act_delta1 + act_delta2)
    act_distance2 = current_distance2 - act_delta1
    min_caldistance = min_caldistance1
    if (min_caldistance2 < min_caldistance) {
    	min_caldistance = min_caldistance2
    }
    if (act_distance2 < min_caldistance) {
	act_distance2 = min_caldistance
    }
    if (act_distance < min_caldistance) {
	act_distance = min_caldistance
    }
    if (act_width < min_calwidth) {
	act_width = min_calwidth
    }
    C = 0.0
    new_max_caldist =  2.5 *  max_caldistance
    if (current_distance2 > 0.0) {
        C = current_length * (0.0237181 * exp(-0.000823037*act_distance) / pow(act_distance,0.481479)) * pow(act_width,0.0632942) * pow(act_distance2,0.178406)
    }
    if (current_distance2 <= 0.0) {
        C = current_length * (0.0237181 * exp(-0.000823037*act_distance) / pow(act_distance,0.481479)) * pow(act_width,0.0632942) * pow(new_max_caldist,0.178406)
    }
    if ((distance2_behind() > 0.0) && (distance2_behind() < max_distance) && (current_distance2 > 0) && (current_distance2 < current_distance)) {
	C = 0
    } 
    C = C * scaleunits
]

#ENDCRYPT


#ENCRYPT
//
//  model: 114  target: nearbody2  profile: ultra layers: base,XCALIBRATE__M1,XCALIBRATE__MC
//
CAPACITANCE NEARBODY XCALIBRATE__M1 XCALIBRATE__MC INSIDE OF XCALIBRATE__MC MASK
[
    PROPERTY C
    max_caldistance = 1202.5 // For reference
    min_calwidth = 12 // For reference
    min_caldistance1 = 8 // For reference
    min_caldistance2 = 8 // For reference
    max_distance = (MAXDISTANCE_XCALIBRATE__M1 + MAXDISTANCE_XCALIBRATE__MC) / 2
    max_width = (MAXWIDTH_XCALIBRATE__M1 + MAXWIDTH_XCALIBRATE__MC) / 2
    scaleunits = 1e-15/1e-15
    profile = ultra_profileid
    model = 114
	current_distance = distance()
	current_distance2 = distance2()
	current_width1 = width1()
	current_width2 = width2()
	current_length = length()
	corner = corner_index()
    if (current_distance2 <= 0.0) {
    	act_delta1 = lookup1 (delta_tbl(),layer1(), corner, current_width1, max_caldistance)
    	act_delta2 = lookup1 (delta_tbl(),layer2(), corner, current_width2, max_caldistance)
    } else {
    	act_delta1 = lookup1 (delta_tbl(),layer1(), corner, current_width1, current_distance2)
	real_distance3 = current_distance + distance3()
    	act_delta2 = lookup1 (delta_tbl(),layer2(), corner, current_width2, real_distance3)
    }
    act_width1 = current_width1 + act_delta1
    act_width2 = current_width2 + act_delta2
    act_width = 2 * act_width1 * act_width2 / (act_width1 + act_width2)
    act_distance = current_distance - 0.5 * (act_delta1 + act_delta2)
    act_distance2 = current_distance2 - act_delta1
    min_caldistance = min_caldistance1
    if (min_caldistance2 < min_caldistance) {
    	min_caldistance = min_caldistance2
    }
    if (act_distance2 < min_caldistance) {
	act_distance2 = min_caldistance
    }
    if (act_distance < min_caldistance) {
	act_distance = min_caldistance
    }
    if (act_width < min_calwidth) {
	act_width = min_calwidth
    }
    C = 0.0
    new_max_caldist =  2.5 *  max_caldistance
    if (current_distance2 > 0.0) {
        C = current_length * (0.0228932 * exp(-0.00084179*act_distance) / pow(act_distance,0.475589)) * pow(act_width,0.0637354) * pow(act_distance2,0.179975)
    }
    if (current_distance2 <= 0.0) {
        C = current_length * (0.0228932 * exp(-0.00084179*act_distance) / pow(act_distance,0.475589)) * pow(act_width,0.0637354) * pow(new_max_caldist,0.179975)
    }
    if ((distance2_behind() > 0.0) && (distance2_behind() < max_distance) && (current_distance2 > 0) && (current_distance2 < current_distance)) {
	C = 0
    } 
    C = C * scaleunits
]
CAPACITANCE NEARBODY XCALIBRATE__MC XCALIBRATE__M1 INSIDE OF XCALIBRATE__M1 MASK
[
    PROPERTY C
    max_caldistance = 1202.5 // For reference
    min_calwidth = 12 // For reference
    min_caldistance1 = 8 // For reference
    min_caldistance2 = 8 // For reference
    max_distance = (MAXDISTANCE_XCALIBRATE__M1 + MAXDISTANCE_XCALIBRATE__MC) / 2
    max_width = (MAXWIDTH_XCALIBRATE__M1 + MAXWIDTH_XCALIBRATE__MC) / 2
    scaleunits = 1e-15/1e-15
    profile = ultra_profileid
    model = 114
	current_distance = distance()
	current_distance2 = distance2()
	current_width1 = width1()
	current_width2 = width2()
	current_length = length()
	corner = corner_index()
    if (current_distance2 <= 0.0) {
    	act_delta1 = lookup1 (delta_tbl(),layer1(), corner, current_width1, max_caldistance)
    	act_delta2 = lookup1 (delta_tbl(),layer2(), corner, current_width2, max_caldistance)
    } else {
    	act_delta1 = lookup1 (delta_tbl(),layer1(), corner, current_width1, current_distance2)
	real_distance3 = current_distance + distance3()
    	act_delta2 = lookup1 (delta_tbl(),layer2(), corner, current_width2, real_distance3)
    }
    act_width1 = current_width1 + act_delta1
    act_width2 = current_width2 + act_delta2
    act_width = 2 * act_width1 * act_width2 / (act_width1 + act_width2)
    act_distance = current_distance - 0.5 * (act_delta1 + act_delta2)
    act_distance2 = current_distance2 - act_delta1
    min_caldistance = min_caldistance1
    if (min_caldistance2 < min_caldistance) {
    	min_caldistance = min_caldistance2
    }
    if (act_distance2 < min_caldistance) {
	act_distance2 = min_caldistance
    }
    if (act_distance < min_caldistance) {
	act_distance = min_caldistance
    }
    if (act_width < min_calwidth) {
	act_width = min_calwidth
    }
    C = 0.0
    new_max_caldist =  2.5 *  max_caldistance
    if (current_distance2 > 0.0) {
        C = current_length * (0.0228932 * exp(-0.00084179*act_distance) / pow(act_distance,0.475589)) * pow(act_width,0.0637354) * pow(act_distance2,0.179975)
    }
    if (current_distance2 <= 0.0) {
        C = current_length * (0.0228932 * exp(-0.00084179*act_distance) / pow(act_distance,0.475589)) * pow(act_width,0.0637354) * pow(new_max_caldist,0.179975)
    }
    if ((distance2_behind() > 0.0) && (distance2_behind() < max_distance) && (current_distance2 > 0) && (current_distance2 < current_distance)) {
	C = 0
    } 
    C = C * scaleunits
]

#ENDCRYPT


#ENCRYPT
//
//  model: 114  target: nearbody2  profile: ultra layers: base,XCALIBRATE__M2,XCALIBRATE__MC
//
CAPACITANCE NEARBODY XCALIBRATE__M2 XCALIBRATE__MC INSIDE OF XCALIBRATE__MC MASK
[
    PROPERTY C
    max_caldistance = 1206 // For reference
    min_calwidth = 12 // For reference
    min_caldistance1 = 8 // For reference
    min_caldistance2 = 8 // For reference
    max_distance = (MAXDISTANCE_XCALIBRATE__M2 + MAXDISTANCE_XCALIBRATE__MC) / 2
    max_width = (MAXWIDTH_XCALIBRATE__M2 + MAXWIDTH_XCALIBRATE__MC) / 2
    scaleunits = 1e-15/1e-15
    profile = ultra_profileid
    model = 114
	current_distance = distance()
	current_distance2 = distance2()
	current_width1 = width1()
	current_width2 = width2()
	current_length = length()
	corner = corner_index()
    if (current_distance2 <= 0.0) {
    	act_delta1 = lookup1 (delta_tbl(),layer1(), corner, current_width1, max_caldistance)
    	act_delta2 = lookup1 (delta_tbl(),layer2(), corner, current_width2, max_caldistance)
    } else {
    	act_delta1 = lookup1 (delta_tbl(),layer1(), corner, current_width1, current_distance2)
	real_distance3 = current_distance + distance3()
    	act_delta2 = lookup1 (delta_tbl(),layer2(), corner, current_width2, real_distance3)
    }
    act_width1 = current_width1 + act_delta1
    act_width2 = current_width2 + act_delta2
    act_width = 2 * act_width1 * act_width2 / (act_width1 + act_width2)
    act_distance = current_distance - 0.5 * (act_delta1 + act_delta2)
    act_distance2 = current_distance2 - act_delta1
    min_caldistance = min_caldistance1
    if (min_caldistance2 < min_caldistance) {
    	min_caldistance = min_caldistance2
    }
    if (act_distance2 < min_caldistance) {
	act_distance2 = min_caldistance
    }
    if (act_distance < min_caldistance) {
	act_distance = min_caldistance
    }
    if (act_width < min_calwidth) {
	act_width = min_calwidth
    }
    C = 0.0
    new_max_caldist =  2.5 *  max_caldistance
    if (current_distance2 > 0.0) {
        C = current_length * (0.0197767 * exp(-0.000982471*act_distance) / pow(act_distance,0.446224)) * pow(act_width,0.0767626) * pow(act_distance2,0.175791)
    }
    if (current_distance2 <= 0.0) {
        C = current_length * (0.0197767 * exp(-0.000982471*act_distance) / pow(act_distance,0.446224)) * pow(act_width,0.0767626) * pow(new_max_caldist,0.175791)
    }
    if ((distance2_behind() > 0.0) && (distance2_behind() < max_distance) && (current_distance2 > 0) && (current_distance2 < current_distance)) {
	C = 0
    } 
    C = C * scaleunits
]
CAPACITANCE NEARBODY XCALIBRATE__MC XCALIBRATE__M2 INSIDE OF XCALIBRATE__M2 MASK
[
    PROPERTY C
    max_caldistance = 1206 // For reference
    min_calwidth = 12 // For reference
    min_caldistance1 = 8 // For reference
    min_caldistance2 = 8 // For reference
    max_distance = (MAXDISTANCE_XCALIBRATE__M2 + MAXDISTANCE_XCALIBRATE__MC) / 2
    max_width = (MAXWIDTH_XCALIBRATE__M2 + MAXWIDTH_XCALIBRATE__MC) / 2
    scaleunits = 1e-15/1e-15
    profile = ultra_profileid
    model = 114
	current_distance = distance()
	current_distance2 = distance2()
	current_width1 = width1()
	current_width2 = width2()
	current_length = length()
	corner = corner_index()
    if (current_distance2 <= 0.0) {
    	act_delta1 = lookup1 (delta_tbl(),layer1(), corner, current_width1, max_caldistance)
    	act_delta2 = lookup1 (delta_tbl(),layer2(), corner, current_width2, max_caldistance)
    } else {
    	act_delta1 = lookup1 (delta_tbl(),layer1(), corner, current_width1, current_distance2)
	real_distance3 = current_distance + distance3()
    	act_delta2 = lookup1 (delta_tbl(),layer2(), corner, current_width2, real_distance3)
    }
    act_width1 = current_width1 + act_delta1
    act_width2 = current_width2 + act_delta2
    act_width = 2 * act_width1 * act_width2 / (act_width1 + act_width2)
    act_distance = current_distance - 0.5 * (act_delta1 + act_delta2)
    act_distance2 = current_distance2 - act_delta1
    min_caldistance = min_caldistance1
    if (min_caldistance2 < min_caldistance) {
    	min_caldistance = min_caldistance2
    }
    if (act_distance2 < min_caldistance) {
	act_distance2 = min_caldistance
    }
    if (act_distance < min_caldistance) {
	act_distance = min_caldistance
    }
    if (act_width < min_calwidth) {
	act_width = min_calwidth
    }
    C = 0.0
    new_max_caldist =  2.5 *  max_caldistance
    if (current_distance2 > 0.0) {
        C = current_length * (0.0197767 * exp(-0.000982471*act_distance) / pow(act_distance,0.446224)) * pow(act_width,0.0767626) * pow(act_distance2,0.175791)
    }
    if (current_distance2 <= 0.0) {
        C = current_length * (0.0197767 * exp(-0.000982471*act_distance) / pow(act_distance,0.446224)) * pow(act_width,0.0767626) * pow(new_max_caldist,0.175791)
    }
    if ((distance2_behind() > 0.0) && (distance2_behind() < max_distance) && (current_distance2 > 0) && (current_distance2 < current_distance)) {
	C = 0
    } 
    C = C * scaleunits
]

#ENDCRYPT


#ENCRYPT
//
//  model: 203  target: crossoverp  profile: ultra  layers: ultra_base,XCALIBRATE__M1,XCALIBRATE__M2
//
CAPACITANCE CROSSOVER PLATE XCALIBRATE__M1 XCALIBRATE__M2 MASK
[
    PROPERTY C
    scaleunits = 1e-15/1e-15
    profile = ultra_profileid
    dp1(1) = {0 }
    dp1val = get_value ("dp1", corner_index())
    model = 203
    C = 0.0548955 * area()
    dcdp1 = 0.110062 * area()
    dcdub = 0.110062 * area()
    if (PLATE_LOADING > 0) {
		maxw = 60
		maxd = 1206
        if (THK_D_ACT_XCALIBRATE__M2 > 0 ) {
            bmax = lookup1 ("THICKNESS_D_ACT",layer2(), corner_index(), maxw, maxd)
        } else {    
            bmax = lookup1 ("THICKNESS_D",layer2(), corner_index(), maxw, maxd)
        }
	    C = C - (dcdp1 * dp1val) - (dcdub * bmax) * LOADING_FACTOR 
    } else {
	    C = C - dcdp1 * dp1val
    }
    C = C * scaleunits
]

#ENDCRYPT


#ENCRYPT
//
//  model: 203  target: crossoverp  profile: ultra  layers: ultra_base,XCALIBRATE__M1,XCALIBRATE__MC
//
CAPACITANCE CROSSOVER PLATE XCALIBRATE__M1 XCALIBRATE__MC MASK
[
    PROPERTY C
    scaleunits = 1e-15/1e-15
    profile = ultra_profileid
    dp1(1) = {0 }
    dp1val = get_value ("dp1", corner_index())
    model = 203
    C = 0.0298352 * area()
    dcdp1 = 0.0325107 * area()
    dcdub = 0.0325107 * area()
    if (PLATE_LOADING > 0) {
		maxw = 60
		maxd = 1202.5
        if (THK_D_ACT_XCALIBRATE__MC > 0 ) {
            bmax = lookup1 ("THICKNESS_D_ACT",layer2(), corner_index(), maxw, maxd)
        } else {    
            bmax = lookup1 ("THICKNESS_D",layer2(), corner_index(), maxw, maxd)
        }
	    C = C - (dcdp1 * dp1val) - (dcdub * bmax) * LOADING_FACTOR 
    } else {
	    C = C - dcdp1 * dp1val
    }
    C = C * scaleunits
]

#ENDCRYPT


#ENCRYPT
//
//  model: 203  target: crossoverp  profile: ultra  layers: ultra_base,XCALIBRATE__M2,XCALIBRATE__MC
//
CAPACITANCE CROSSOVER PLATE XCALIBRATE__M2 XCALIBRATE__MC MASK
[
    PROPERTY C
    scaleunits = 1e-15/1e-15
    profile = ultra_profileid
    dp1(1) = {0 }
    dp1val = get_value ("dp1", corner_index())
    model = 203
    C = 0.091496 * area()
    dcdp1 = 0.30575 * area()
    dcdub = 0.30575 * area()
    if (PLATE_LOADING > 0) {
		maxw = 60
		maxd = 1202.5
        if (THK_D_ACT_XCALIBRATE__MC > 0 ) {
            bmax = lookup1 ("THICKNESS_D_ACT",layer2(), corner_index(), maxw, maxd)
        } else {    
            bmax = lookup1 ("THICKNESS_D",layer2(), corner_index(), maxw, maxd)
        }
	    C = C - (dcdp1 * dp1val) - (dcdub * bmax) * LOADING_FACTOR 
    } else {
	    C = C - dcdp1 * dp1val
    }
    C = C * scaleunits
]

#ENDCRYPT


#ENCRYPT
//
//  model: 36  target: nearbody  profile: ultra layers: ultra_base,XCALIBRATE__M1,XCALIBRATE__M2
//
CAPACITANCE NEARBODY XCALIBRATE__M1 INSIDE OF XCALIBRATE__M2 MASK
[
    PROPERTY C
    max_calwidth = 60 // For reference
    max_caldistance = 1202.5 // For reference
    min_calwidth = 12 // For reference
    min_caldistance = 8 // For reference
    max_width = MAXWIDTH_XCALIBRATE__M1
    max_distance = MAXDISTANCE_XCALIBRATE__M1
    max_enclose = MAXENCLOSE_XCALIBRATE__M1
    max_radius = MAXRADIUS_XCALIBRATE__M1
    scaleunits = 1e-15/1e-15
    profile = ultra_profileid
    dt(1) = {0}
	current_width1 = width1()
	current_width2 = width2()
	corner = corner_index()
	current_distance = distance()
    dtval = get_value ("dt", corner)
    cor_thickness = lookup1 ("NOM_THICKNESS",layer1(), corner, -1, -1)
    dtindie = thickness1() - cor_thickness
    distanceb = distance_behind() - current_width1
    if (MULTI_BIAS_XCALIBRATE__M1 > 0 ) {
    	act_delta_right = lookup1 (bias1_tbl(),layer1(), corner, current_width1, current_distance)
    	act_delta_left = lookup1 (bias1_tbl(),layer1(), corner, current_width1, distanceb)
    	act_delta = lookup1 (bias1_tbl(),layer1(), corner, current_width2, current_distance)
    	act_width1 = current_width1 + (act_delta_left + act_delta_right)
    	act_width2 = current_width2 + 2 * act_delta
    	act_distance1 = current_distance - (act_delta_right + act_delta)
    	act_distanceb = distanceb - 2 * act_delta_left 
    	act_delta_right = lookup1 (bias2_tbl(),layer1(), corner, act_width1, act_distance1)
    	act_delta_left = lookup1 (bias2_tbl(),layer1(), corner, act_width1, act_distanceb)
    	act_delta = lookup1 (bias2_tbl(),layer1(), corner, act_width2, act_distance1)
    	act_distance = act_distance1 - (act_delta_right + act_delta) 
    	act_width12 = act_width1 + (act_delta_left + act_delta_right)
    	act_width22 = act_width2 + 2 * act_delta
    	act_width = 2 * act_width12 * act_width22 / (act_width12 + act_width22)
    } else {
    	act_delta_right = lookup1 (delta_tbl(),layer1(), corner, current_width1, current_distance)
    	act_delta_left = lookup1 (delta_tbl(),layer1(), corner, current_width1, distanceb)
    	act_delta = lookup1 (delta_tbl(),layer1(), corner, current_width2, current_distance)
    	act_width1 = current_width1 + 0.5 * (act_delta_left + act_delta_right)
    	act_width2 = current_width2 + act_delta
    	act_distance = current_distance - 0.5 * (act_delta_right + act_delta)
    	act_width = 2 * act_width1 * act_width2 / (act_width1 + act_width2)
    }
 	if ( mask_offset() != -1 ) { 
    act_distance = act_distance + mask_offset()
	} 
    if (act_distance < min_caldistance) {
	act_distance = min_caldistance	
    }
    if (act_width < min_calwidth) {
	act_width = min_calwidth	
    }
    nval = 0 
    sval = 0 
    if ( PEX_USE_K_VARIATION > 0 ) { 
 	if ( PEX_XCALIBRATE__M1_USE_SIDEWALL_K_VARIATION > 0 ) { 
 	   if ( mask_offset() == -1 ) { 
	      if (PEX_XCALIBRATE__M1_SIDEWALL_K_DRAWN > 0) {
	         nval = lookup1 ("SIDEWALL_K",layer1(), 0, current_width1, current_distance) 
 	         sval = lookup1 ("SIDEWALL_K",layer1(), corner,current_width1, current_distance) 
	      } else { 
 	         nval = lookup1 ("SIDEWALL_K_ACT",layer1(), 0, act_width, act_distance) 
  	         sval = lookup1 ("SIDEWALL_K_ACT",layer1(), corner,act_width, act_distance) 
	      } 
 	      dtindie  = dtindie + thickness1() * ((sval/nval) - 1) 
	   } 
        } 
    } 
    model = 36
    model = 6
        nb =  (0.00107518*exp(-0.0840084 * act_distance) + 0.00512552 * pow(act_distance , -0.710314)) * pow(act_width , 0.676861)
    dndt = ((0.00752316*exp(-0.0715336 * act_distance ) + 0.005 * pow(act_distance,-61.5825))*pow(act_width, 0.15535))
    current_length = length()
    C = current_length * nb 
    dndt = current_length * dndt 
    if( distance_shield() > 0 ) {
    	nbr = 1
    	if (nbr < 0.97 ) {
	    nbr = 0.97
	} else if ( nbr > 1 ) {
	    nbr = 1
	}
    	C = C * nbr
    }
    if ((inside_up() < EPS_ENC) && (inside_up() >= 0) && (radius_up() < max_radius) && (radius_down() >= max_radius)) {
	model = 114
	C = current_length * (exp(-4.70458 - 0.00287164 * act_distance ) + 0.251649 / pow(act_distance,0.729567)) * 0.189237 * pow(act_width, 0.150677) * pow(radius_up(),0.117458)
	dndt = 0
    }
    C = C + dndt * (dtval + dtindie)
    C = C * scaleunits
]

#ENDCRYPT


#ENCRYPT
//
//  model: 36  target: crossovere  profile: ultra layers: ultra_base,XCALIBRATE__M1,XCALIBRATE__M2
//
CAPACITANCE CROSSOVER FRINGE XCALIBRATE__M1 XCALIBRATE__M2 MASK
[
    PROPERTY C
    max_calwidth = 60 // For reference
    max2_calwidth = 28 // For reference
    max_caldistance = 1202.5 // For reference
    max2_caldistance = 642.63 // For reference
    max_calenclose = 1202.5 // For reference
    min_calwidth = 12 // For reference
    min_caldistance = 8 // For reference
    max_width = MAXWIDTH_XCALIBRATE__M1
    max_distance = MAXDISTANCE_XCALIBRATE__M1
    max_enclose = MAXENCLOSE_XCALIBRATE__M1
    max_radius = MAXRADIUS_XCALIBRATE__M1
    scaleunits = 1e-15/1e-15
    profile = ultra_profileid
    height = 0.5
    dp1(1) = {0}
	current_width = width()
	current_width2 = width2()
	corner = corner_index()
    dp1val = get_value ("dp1", corner)
    if (distance() <= 0.0) {
	dist = max_caldistance
    } else {
	dist = distance()
    }
    distb = distance_behind() - current_width
    if (MULTI_BIAS_XCALIBRATE__M1 > 0 ) {
    	act_delta_right = lookup1 (bias1_tbl(),layer1(), corner, current_width, dist)
    	act_delta_left = lookup1 (bias1_tbl(),layer1(), corner, current_width, distb)
    	act_delta2 = lookup1 (bias1_tbl(),layer1(), corner, current_width2, dist)
    	act_delta = (act_delta_left + act_delta_right)
    	act_width1 = current_width + act_delta
    	act_width2 = current_width2 + 2 * act_delta2
    	act_dist = dist - (act_delta_right + act_delta2)
    	act_distb = distb - 2 * act_delta_left
    	act_enclose = enclose() - act_delta_right
    	act_delta_right = lookup1 (bias2_tbl(),layer1(), corner, act_width1, act_dist)
    	act_delta_left = lookup1 (bias2_tbl(),layer1(), corner, act_width1, act_distb)
    	act_delta2 = lookup1 (bias2_tbl(),layer1(), corner, act_width2, act_dist)
    	act_delta = act_delta + (act_delta_left + act_delta_right)
    	act_width = current_width + act_delta
    	act_distance = act_dist - (act_delta_right + act_delta2)
    	act_enclose = act_enclose - act_delta_right 
    } else {
    	act_delta_right = lookup1 (delta_tbl(),layer1(), corner, current_width, dist)
    	act_delta_left = lookup1 (delta_tbl(),layer1(), corner, current_width, distb)
    	act_delta2 = lookup1 (delta_tbl(),layer1(), corner, current_width2, dist)
    	act_delta = 0.5 * (act_delta_left + act_delta_right)
   	act_enclose = enclose() - 0.5 * act_delta_right
        act_width = current_width + act_delta 
        act_distance = dist - 0.5 * (act_delta_right + act_delta2)
    }	
 	if ( mask_offset() != -1 ) { 
    act_distance = act_distance + mask_offset()
	} 
    if (act_distance < min_caldistance) {
	act_distance = min_caldistance	
    }
    if (act_width < min_calwidth) {
	act_width = min_calwidth	
    }
    if (act_enclose < 0) {
	act_enclose = 0
    }
    model = 36
    C = 0.0
    dcdp1 = 0.0
    dcdub = 0.0
    new_max_caldist = 2.5 * max_caldistance
	current_distance = distance()
	current_length = length()
    if ((current_distance > 0.0) && (same_net() == 0) && (enclose() >= max_enclose)) {
	model = 6
	       	cr = (0.0393606 * (1 - exp(--11.3968 * (act_distance + -87.7346))) * pow(act_width , 0.00152261 * act_distance + 0.16227))
    	dcdp1 = (0.00710225 * (1 - exp(-58.9395 * (act_distance + 1000))) * pow(act_width , -0.00101754 * act_distance + 0.603747) ) 
    	dcdub = (0.00710225 * (1 - exp(-58.9395 * (act_distance + 1000))) * pow(act_width , -0.00101754 * act_distance + 0.603747) )
        C = current_length * ( cr + 0.5 * 0.0548955 * act_delta) 
        dcdp1 = current_length * ( dcdp1 + 0.5 * 0.110062 * act_delta) 
        dcdub = current_length * ( dcdub + 0.5 * 0.110062 * act_delta) 
    }
    if ((current_distance > 0.0) && (same_net() == 1) && (enclose() >= max_enclose)) {
	model = 60
        C = current_length * (0.0733522 * (1 - exp(-0.0739169 * (act_distance + 15.3516))) + 0.5 * 0.0548955 * act_delta)
    }
    if ((current_distance <= 0.0) && (enclose() >= max_enclose)) {
	model = 8	
        C = current_length * (0.0412867 * pow(act_width , 0.206943) + 0.5 * 0.0548955 * act_delta)
	dcdp1 = current_length * (0.0092391 * pow(act_width, 0.441894) + 0.5 * 0.110062 * act_delta)
	dcdub = current_length * (0.0092391 * pow(act_width, 0.441894) + 0.5 * 0.110062 * act_delta)
    }
    if ((current_distance > 0.0) && (enclose() < max_enclose) && (enclose() < current_distance)) {
	model = 26
        C = current_length * (0.5 * (1.6905e-06 * act_distance + 0.179939) * (0.752319 - exp(-(1.75597e-05 * act_distance + 0.231811) * (act_enclose + -0.000241593 * act_distance + 3.65605) - (0.000182026 * act_distance + -0.0190179) * (act_enclose + 0.00029925 * act_distance + -0.683598) * (act_enclose + 0.00029925 * act_distance + -0.683598))) + 0.5 * 0.0548955 * act_delta)
    }
    if ((current_distance > 0.0) && (enclose() < max_enclose) && (enclose() >= current_distance)) {
	model = 6
	       	cr = (0.0393606 * (1 - exp(--11.3968 * (act_distance + -87.7346))) * pow(act_width , 0.00152261 * act_distance + 0.16227))
    	dcdp1 = (0.00710225 * (1 - exp(-58.9395 * (act_distance + 1000))) * pow(act_width , -0.00101754 * act_distance + 0.603747) ) 
    	dcdub = (0.00710225 * (1 - exp(-58.9395 * (act_distance + 1000))) * pow(act_width , -0.00101754 * act_distance + 0.603747) )
        C = current_length * ( cr + 0.5 * 0.0548955 * act_delta) 
        dcdp1 = current_length * ( dcdp1 + 0.5 * 0.110062 * act_delta) 
        dcdub = current_length * ( dcdub + 0.5 * 0.110062 * act_delta) 
    }
    if ((current_distance <= 0.0) && (enclose() < max_enclose)) {
	model = 26
        C = current_length * (0.5 * (1.6905e-06 * new_max_caldist + 0.179939) * (0.752319 - exp(-(1.75597e-05 * new_max_caldist + 0.231811) * (act_enclose + -0.000241593 * new_max_caldist + 3.65605) - (0.000182026 * new_max_caldist + -0.0190179) * (act_enclose + 0.00029925 * new_max_caldist + -0.683598) * (act_enclose + 0.00029925 * new_max_caldist + -0.683598))) + 0.5 * 0.0548955 * act_delta)
    }
    if ((current_distance > 0.0) && (enclose() < EPS_ENC) && (enclose() >= 0) && (radius_up() < max_radius) && (radius_down() >= max_radius)) {
	model = 114	
        C = current_length * (0.284906 * (1.0 - exp( -0.055932 * (act_distance + 72.1653))) * pow(act_width,4.46398e-07 * act_distance + -0.000104816) * pow(radius_up(),0.0022889) + 0.5 * 0.0548955 * act_delta)
    }
    if ((current_distance <= 0.0) && (enclose() < max_enclose) && (enclose() >= 0) && (radius_up() >= max_radius) && (radius_down() >= max_radius) && (radius_up_behind() >= max_radius) && (radius_down_behind() >= max_radius)) {
	model = 11
        C = current_length * (0.0436976 * pow(act_width , 0.172478) * (1.0 - exp(-0.319888 * (act_enclose + 1.90301))) + 0.5 * 0.0548955 * act_delta)
	dcdp1 = current_length * (0.00966443 * pow(act_width, 0.436323) * (1.0 - exp(-4.17586 * (act_enclose + 0.179092))) + 0.5 * 0.110062 * act_delta)
	dcdub = current_length * (0.00966443 * pow(act_width, 0.436323) * (1.0 - exp(-4.17586 * (act_enclose + 0.179092))) + 0.5 * 0.110062 * act_delta)
    }
    if ((act_width >= radius_up_behind()) && (radius_up() < max_radius) && (radius_down() >= max_radius) && (radius_up_behind() < max_radius) && (radius_down_behind() >= max_radius)) {
	model = 19
        C = current_length * (1.70502 * (1.0 - exp( -1000 * (radius_up() + 0.000274746))) * (1.0 - exp( -1000 * (radius_up_behind() + 4.64678e-05))) + 0.5 * 0.0548955 * act_delta)
    }
    mydistshield = 2 * current_distance + current_width
    mydistb = current_distance + current_width 
    vdsh = 10 * distance_shield()
    vdb = 10 * distance_behind()
    if ((current_distance > 0.0) && (enclose() >= max_enclose) && (distance_shield() <= mydistshield) && (distance_behind() <= mydistb) && (vdsh < height) && (vdb < height)) {
        C = CFR_MUL_36 * C 
    }
    if (C < 0.0) {
        C = 0
    }
    if (dcdp1 < 0.0) {
        dcdp1 = 0
    }
    if (dcdub < 0.0) {
        dcdub = 0
    }
    maxw = 60
    maxd = 1206
    upw = upper_loading() 
    if (THK_D_ACT_XCALIBRATE__M2 > 0 ) {
        bval = lookup1 ("THICKNESS_D_ACT",layer2(), corner,upw,upw)
        bmax = lookup1 ("THICKNESS_D_ACT",layer2(), corner,maxw,maxd)
    } else {	
        bval = lookup1 ("THICKNESS_D",layer2(), corner,upw,upw)
        bmax = lookup1 ("THICKNESS_D",layer2(), corner,maxw,maxd)
    }	
    if (PLATE_LOADING > 0) {
	    C = C - dcdp1 * dp1val - dcdub * bval - 0.5 * (bval - bmax) * LOADING_FACTOR * current_length * current_width * 0.110062 
    } else {
	    C = C - dcdp1 * dp1val
    }
    if (C < 0) {
	C = 0
    }
    C = C * scaleunits
]

#ENDCRYPT


#ENCRYPT
//
//  model: 36  target: intrinsic  profile: ultra layers: ultra_base,XCALIBRATE__M1,XCALIBRATE__M2
//
CAPACITANCE INTRINSIC FRINGE XCALIBRATE__M1 INSIDE OF XCALIBRATE__M2 MASK
[
    PROPERTY C
    max_calwidth = 60 // For reference
    max_caldistance = 1202.5 // For reference
    max2_calwidth = 28 // For reference
    max2_caldistance = 642.63 // For reference
    min_calwidth = 12 // For reference
    min_caldistance = 8 // For reference
    max_width = MAXWIDTH_XCALIBRATE__M1
    max_distance = MAXDISTANCE_XCALIBRATE__M1
    max_enclose = MAXENCLOSE_XCALIBRATE__M1
    max_radius = MAXRADIUS_XCALIBRATE__M1
    scaleunits = 1e-15/1e-15
    profile = ultra_profileid
    dm1(1) = {0}
	current_width = width()
	current_width2 = width2()
	corner = corner_index()
    dm1val = get_value ("dm1", corner)
    if (distance() <= 0.0) {
	dist = max_caldistance
    } else {
	dist = distance()
    }
    distb = distance_behind() - current_width
    if (MULTI_BIAS_XCALIBRATE__M1 > 0 ) {
        act_delta_right = lookup1 (bias1_tbl(),layer1(), corner, current_width, dist)
    	act_delta_left = lookup1 (bias1_tbl(),layer1(), corner, current_width, distb)
    	act_delta2 = lookup1 (bias1_tbl(),layer1(), corner, current_width2, dist)
    	act_delta = (act_delta_left + act_delta_right)
    	act_width1 = current_width + act_delta
    	act_width2 = current_width2 + 2 * act_delta2
    	act_dist = dist - (act_delta_right + act_delta2)
    	act_distb = distb - 2 * act_delta_left 
    	act_up = inside_up() - act_delta_right
    	act_delta_right = lookup1 (bias2_tbl(),layer1(), corner, act_width1, act_dist)
    	act_delta_left = lookup1 (bias2_tbl(),layer1(), corner, act_width1, act_distb)
    	act_delta2 = lookup1 (bias2_tbl(),layer1(), corner, act_width2, act_dist)
    	act_delta = act_delta + (act_delta_left + act_delta_right)
    	act_width = current_width + act_delta
    	act_distance = act_dist - (act_delta_right + act_delta2)
    	act_distb = act_distb - 2 * act_delta_left 
    	act_in_up = act_up - act_delta_right
    } else {
    	act_delta_right = lookup1 (delta_tbl(),layer1(), corner, current_width, dist)
    	act_delta_left = lookup1 (delta_tbl(),layer1(), corner, current_width, distb)
    	act_delta2 = lookup1 (delta_tbl(),layer1(), corner, current_width2, dist)
    	act_delta = 0.5 * (act_delta_left + act_delta_right)
        act_width = current_width + act_delta 
        act_distance = dist - 0.5 * (act_delta_right + act_delta2)
        act_distb = distb - act_delta_left
    	act_in_up = inside_up() - act_delta_right / 2.0
    }
 	if ( mask_offset() != -1 ) { 
    act_distance = act_distance + mask_offset()
	} 
    nrval = 0 
    nlval = 0 
    rval = 0 
    lval = 0 
    if ( PEX_USE_K_VARIATION > 0 ) { 
 	if ( PEX_XCALIBRATE__M1_USE_BOTTOM_K_VARIATION > 0 ) { 
	nrval = lookup1 ("BOTTOM_K",layer1(), 0,current_width, dist) 
 	nlval = lookup1 ("BOTTOM_K",layer1(), 0,current_width, distb) 
 	rval = lookup1 ("BOTTOM_K",layer1(), corner,current_width, dist) 
 	lval = lookup1 ("BOTTOM_K",layer1(), corner,current_width, distb) 
	act_width  = act_width + current_width*((rval+lval)/(nrval+nlval)-1) 
    } 
	} 
    if (act_distance < min_caldistance) {
	act_distance = min_caldistance	
    }
    if (act_width < min_calwidth) {
	act_width = min_calwidth	
    }
    if (act_in_up < 0) {
	act_in_up = 0
    }
    model = 36
    C = 0.0
    didm1 = 0.0
    dcdb  = 0.0
	current_distance = distance()
	current_length = length()
    if ((current_distance > 0.0) && (same_net() == 0)) {
	model = 6 
	   intr = (0.0199867 * (1 - exp(-0.865126 * (act_distance + -0.971701))) * pow(act_width , 0.000437595 * act_distance + -1.87252) )
			didm1 = (1.24544e-06 * (1 - exp(-3.5924e-07 * (act_distance + 1000))) * pow(act_width , -0.000253158 * act_distance + -1.40119) )
			dcdb  = (1.24544e-06 * (1 - exp(-3.5924e-07 * (act_distance + 1000))) * pow(act_width , -0.000253158 * act_distance + -1.40119) )
        C = current_length * ( intr + 0.5 * 4.4271e-05 * act_delta) 
        didm1 = current_length * ( didm1 + 0.5 * 4.43821e-08 * act_delta) 
        dcdb = current_length * ( dcdb + 0.5 * 4.43821e-08 * act_delta)
    }
    if ((current_distance > 0.0) && (same_net() == 1)) {
	model = 60
        C = current_length * (8.31512e-05 * (1 - exp(-1.00615 * (act_distance + -4.79831)))+ 0.5 * 4.4271e-05 * act_delta)
    }
    if (current_distance <= 0.0) {
	model = 8
        C = current_length * (2.68e-05 * pow(act_width , 0.447168)+ 0.5 * 4.4271e-05 * act_delta)
	didm1 = current_length * (2.57632e-08 * pow(act_width , 0.452552) + 0.5 * 4.43821e-08 * act_delta)
	dcdb  = current_length * (2.57632e-08 * pow(act_width , 0.452552) + 0.5 * 4.43821e-08 * act_delta)
    }
    if ((current_distance > 0.0) && (inside_up() < EPS_ENC) && (inside_up() >= 0) && (radius_up() < max_radius) && (radius_down() >= max_radius))  {
	model = 114
        C = current_length * (0.00695052 * (1.0 - exp( -0.0151477 * (act_distance + 125.132))) * pow(act_width,2.39105e-05 * act_distance + -0.0883052) * pow(radius_up(),0.0466804)+ 0.5 * 4.4271e-05 * act_delta)
    }
    if ((current_distance > 0.0) && (distance_behind() > 0.0) && (inside_up() < EPS_ENC) && (inside_up() >= 0) && (radius_up() < max_radius) && (radius_down() >= max_radius) && (radius_down_behind() >= max_radius))  {
        model = 1114
        C = current_length * (4.86185 * (1.0 - exp( -0.035627 * (act_distance + 27.9545))) * pow(act_width,-4.84322e-05 * act_distance + 0.0251037) * pow(radius_up(),0.107431) * (1.0 - 0.99965 * exp( -1.51262e-06 * act_distb / min_caldistance)) + 0.5 * 4.4271e-05 * act_delta)
        
        if(distance_shield() > 0 && distance_shield() <= 1.5 * (min_calwidth + min_caldistance) ) {
            C = XCAL_M1114_F * C
        }
        
    }
    if ((current_distance <= 0.0) && (inside_up() < max_enclose) && (inside_up() >= 0) && (radius_up() >= max_radius) && (radius_down() >= max_radius) && (radius_up_behind() >= max_radius) && (radius_down_behind() >= max_radius))  {
	model = 11
        C = (0.00351128 * pow(act_width,0.538717) * exp(-0.0280226 * (act_in_up + 30.1119)))
        C = current_length * (C + 0.5 * 4.4271e-05 * act_delta)
	didm1 = current_length * (6.12229e-07 * pow(act_width,0.379564) * exp(-0.0437799 * (act_in_up + 3.7427)) + 0.5 * 4.43821e-08 * act_delta)
	dcdb  = current_length * (6.12229e-07 * pow(act_width,0.379564) * exp(-0.0437799 * (act_in_up + 3.7427)) + 0.5 * 4.43821e-08 * act_delta)
    }   
    if (C < 0) {
	C = 0
    }
    if (didm1 < 0) {
	didm1 = 0
    }	
    if (THK_D_ACT_XCALIBRATE__M1 > 0 ) {
	bval = lookup1 ("THICKNESS_D_ACT",layer1(), corner,act_width, act_distance)
        bmax = lookup1 ("THICKNESS_D_ACT",layer1(), corner, max_calwidth, max_caldistance)
    } else {	
	bval = lookup1 ("THICKNESS_D",layer1(), corner,current_width, dist)
        bmax = lookup1 ("THICKNESS_D",layer1(), corner,max_calwidth, max_caldistance)
    }	
    if (PLATE_LOADING > 0) {
	    C = C - (didm1 * dm1val) - (dcdb * bval) - 0.5 * (bval - bmax) * LOADING_FACTOR * current_length * current_width * 4.43821e-08
    } else {
	    C = C - (didm1 * dm1val) - (dcdb * bval) - 0.5 * bval * current_length * current_width * 4.43821e-08
    }
    C = C * scaleunits
]

#ENDCRYPT


#ENCRYPT
//
//  model: 36  target: nearbody  profile: ultra layers: ultra_base,XCALIBRATE__M1,XCALIBRATE__MC
//
CAPACITANCE NEARBODY XCALIBRATE__M1 INSIDE OF XCALIBRATE__MC MASK
[
    PROPERTY C
    max_calwidth = 60 // For reference
    max_caldistance = 1202.5 // For reference
    min_calwidth = 12 // For reference
    min_caldistance = 8 // For reference
    max_width = MAXWIDTH_XCALIBRATE__M1
    max_distance = MAXDISTANCE_XCALIBRATE__M1
    max_enclose = MAXENCLOSE_XCALIBRATE__M1
    max_radius = MAXRADIUS_XCALIBRATE__M1
    scaleunits = 1e-15/1e-15
    profile = ultra_profileid
    dt(1) = {0}
	current_width1 = width1()
	current_width2 = width2()
	corner = corner_index()
	current_distance = distance()
    dtval = get_value ("dt", corner)
    cor_thickness = lookup1 ("NOM_THICKNESS",layer1(), corner, -1, -1)
    dtindie = thickness1() - cor_thickness
    distanceb = distance_behind() - current_width1
    if (MULTI_BIAS_XCALIBRATE__M1 > 0 ) {
    	act_delta_right = lookup1 (bias1_tbl(),layer1(), corner, current_width1, current_distance)
    	act_delta_left = lookup1 (bias1_tbl(),layer1(), corner, current_width1, distanceb)
    	act_delta = lookup1 (bias1_tbl(),layer1(), corner, current_width2, current_distance)
    	act_width1 = current_width1 + (act_delta_left + act_delta_right)
    	act_width2 = current_width2 + 2 * act_delta
    	act_distance1 = current_distance - (act_delta_right + act_delta)
    	act_distanceb = distanceb - 2 * act_delta_left 
    	act_delta_right = lookup1 (bias2_tbl(),layer1(), corner, act_width1, act_distance1)
    	act_delta_left = lookup1 (bias2_tbl(),layer1(), corner, act_width1, act_distanceb)
    	act_delta = lookup1 (bias2_tbl(),layer1(), corner, act_width2, act_distance1)
    	act_distance = act_distance1 - (act_delta_right + act_delta) 
    	act_width12 = act_width1 + (act_delta_left + act_delta_right)
    	act_width22 = act_width2 + 2 * act_delta
    	act_width = 2 * act_width12 * act_width22 / (act_width12 + act_width22)
    } else {
    	act_delta_right = lookup1 (delta_tbl(),layer1(), corner, current_width1, current_distance)
    	act_delta_left = lookup1 (delta_tbl(),layer1(), corner, current_width1, distanceb)
    	act_delta = lookup1 (delta_tbl(),layer1(), corner, current_width2, current_distance)
    	act_width1 = current_width1 + 0.5 * (act_delta_left + act_delta_right)
    	act_width2 = current_width2 + act_delta
    	act_distance = current_distance - 0.5 * (act_delta_right + act_delta)
    	act_width = 2 * act_width1 * act_width2 / (act_width1 + act_width2)
    }
 	if ( mask_offset() != -1 ) { 
    act_distance = act_distance + mask_offset()
	} 
    if (act_distance < min_caldistance) {
	act_distance = min_caldistance	
    }
    if (act_width < min_calwidth) {
	act_width = min_calwidth	
    }
    nval = 0 
    sval = 0 
    if ( PEX_USE_K_VARIATION > 0 ) { 
 	if ( PEX_XCALIBRATE__M1_USE_SIDEWALL_K_VARIATION > 0 ) { 
 	   if ( mask_offset() == -1 ) { 
	      if (PEX_XCALIBRATE__M1_SIDEWALL_K_DRAWN > 0) {
	         nval = lookup1 ("SIDEWALL_K",layer1(), 0, current_width1, current_distance) 
 	         sval = lookup1 ("SIDEWALL_K",layer1(), corner,current_width1, current_distance) 
	      } else { 
 	         nval = lookup1 ("SIDEWALL_K_ACT",layer1(), 0, act_width, act_distance) 
  	         sval = lookup1 ("SIDEWALL_K_ACT",layer1(), corner,act_width, act_distance) 
	      } 
 	      dtindie  = dtindie + thickness1() * ((sval/nval) - 1) 
	   } 
        } 
    } 
    model = 36
    model = 6
        nb =  (0.00151347*exp(-0.085685 * act_distance) + 0.00722078 * pow(act_distance , -0.721002)) * pow(act_width , 0.619152)
    dndt = ((0.00756472*exp(-0.0688687 * act_distance ) + 0.005 * pow(act_distance,-62.5066))*pow(act_width, 0.130565))
    current_length = length()
    C = current_length * nb 
    dndt = current_length * dndt 
    if( distance_shield() > 0 ) {
    	nbr = 1
    	if (nbr < 0.97 ) {
	    nbr = 0.97
	} else if ( nbr > 1 ) {
	    nbr = 1
	}
    	C = C * nbr
    }
    if ((inside_up() < EPS_ENC) && (inside_up() >= 0) && (radius_up() < max_radius) && (radius_down() >= max_radius)) {
	model = 114
	C = current_length * (exp(-4.69718 - 0.00289536 * act_distance ) + 0.256094 / pow(act_distance,0.728892)) * 0.197899 * pow(act_width, 0.146855) * pow(radius_up(),0.112769)
	dndt = 0
    }
    C = C + dndt * (dtval + dtindie)
    C = C * scaleunits
]

#ENDCRYPT


#ENCRYPT
//
//  model: 36  target: crossovere  profile: ultra layers: ultra_base,XCALIBRATE__M1,XCALIBRATE__MC
//
CAPACITANCE CROSSOVER FRINGE XCALIBRATE__M1 XCALIBRATE__MC MASK
[
    PROPERTY C
    max_calwidth = 60 // For reference
    max2_calwidth = 28 // For reference
    max_caldistance = 1202.5 // For reference
    max2_caldistance = 642.63 // For reference
    max_calenclose = 1202.5 // For reference
    min_calwidth = 12 // For reference
    min_caldistance = 8 // For reference
    max_width = MAXWIDTH_XCALIBRATE__M1
    max_distance = MAXDISTANCE_XCALIBRATE__M1
    max_enclose = MAXENCLOSE_XCALIBRATE__M1
    max_radius = MAXRADIUS_XCALIBRATE__M1
    scaleunits = 1e-15/1e-15
    profile = ultra_profileid
    height = 0.92
    dp1(1) = {0}
	current_width = width()
	current_width2 = width2()
	corner = corner_index()
    dp1val = get_value ("dp1", corner)
    if (distance() <= 0.0) {
	dist = max_caldistance
    } else {
	dist = distance()
    }
    distb = distance_behind() - current_width
    if (MULTI_BIAS_XCALIBRATE__M1 > 0 ) {
    	act_delta_right = lookup1 (bias1_tbl(),layer1(), corner, current_width, dist)
    	act_delta_left = lookup1 (bias1_tbl(),layer1(), corner, current_width, distb)
    	act_delta2 = lookup1 (bias1_tbl(),layer1(), corner, current_width2, dist)
    	act_delta = (act_delta_left + act_delta_right)
    	act_width1 = current_width + act_delta
    	act_width2 = current_width2 + 2 * act_delta2
    	act_dist = dist - (act_delta_right + act_delta2)
    	act_distb = distb - 2 * act_delta_left
    	act_enclose = enclose() - act_delta_right
    	act_delta_right = lookup1 (bias2_tbl(),layer1(), corner, act_width1, act_dist)
    	act_delta_left = lookup1 (bias2_tbl(),layer1(), corner, act_width1, act_distb)
    	act_delta2 = lookup1 (bias2_tbl(),layer1(), corner, act_width2, act_dist)
    	act_delta = act_delta + (act_delta_left + act_delta_right)
    	act_width = current_width + act_delta
    	act_distance = act_dist - (act_delta_right + act_delta2)
    	act_enclose = act_enclose - act_delta_right 
    } else {
    	act_delta_right = lookup1 (delta_tbl(),layer1(), corner, current_width, dist)
    	act_delta_left = lookup1 (delta_tbl(),layer1(), corner, current_width, distb)
    	act_delta2 = lookup1 (delta_tbl(),layer1(), corner, current_width2, dist)
    	act_delta = 0.5 * (act_delta_left + act_delta_right)
   	act_enclose = enclose() - 0.5 * act_delta_right
        act_width = current_width + act_delta 
        act_distance = dist - 0.5 * (act_delta_right + act_delta2)
    }	
 	if ( mask_offset() != -1 ) { 
    act_distance = act_distance + mask_offset()
	} 
    if (act_distance < min_caldistance) {
	act_distance = min_caldistance	
    }
    if (act_width < min_calwidth) {
	act_width = min_calwidth	
    }
    if (act_enclose < 0) {
	act_enclose = 0
    }
    model = 36
    C = 0.0
    dcdp1 = 0.0
    dcdub = 0.0
    new_max_caldist = 2.5 * max_caldistance
	current_distance = distance()
	current_length = length()
    if ((current_distance > 0.0) && (same_net() == 0) && (enclose() >= max_enclose)) {
	model = 6
	       	cr = (0.0373792 * (1 - exp(--15.676 * (act_distance + -117.116))) * pow(act_width , 0.00198816 * act_distance + 0.117022))
    	dcdp1 = (0.00462803 * (1 - exp(-1000 * (act_distance + 1000))) * pow(act_width , -0.00156957 * act_distance + 0.535685) ) 
    	dcdub = (0.00462803 * (1 - exp(-1000 * (act_distance + 1000))) * pow(act_width , -0.00156957 * act_distance + 0.535685) )
        C = current_length * ( cr + 0.5 * 0.0298352 * act_delta) 
        dcdp1 = current_length * ( dcdp1 + 0.5 * 0.0325107 * act_delta) 
        dcdub = current_length * ( dcdub + 0.5 * 0.0325107 * act_delta) 
    }
    if ((current_distance > 0.0) && (same_net() == 1) && (enclose() >= max_enclose)) {
	model = 60
        C = current_length * (0.0650089 * (1 - exp(-0.0720525 * (act_distance + 12.2538))) + 0.5 * 0.0298352 * act_delta)
    }
    if ((current_distance <= 0.0) && (enclose() >= max_enclose)) {
	model = 8	
        C = current_length * (0.0367433 * pow(act_width , 0.204672) + 0.5 * 0.0298352 * act_delta)
	dcdp1 = current_length * (0.00658312 * pow(act_width, 0.300059) + 0.5 * 0.0325107 * act_delta)
	dcdub = current_length * (0.00658312 * pow(act_width, 0.300059) + 0.5 * 0.0325107 * act_delta)
    }
    if ((current_distance > 0.0) && (enclose() < max_enclose) && (enclose() < current_distance)) {
	model = 26
        C = current_length * (0.5 * (1.86913e-06 * act_distance + 0.166137) * (0.716626 - exp(-(0.00015276 * act_distance + 0.184563) * (act_enclose + -0.0023849 * act_distance + 4.46395) - (8.78244e-05 * act_distance + -0.00984742) * (act_enclose + 0.000802847 * act_distance + 0.792845) * (act_enclose + 0.000802847 * act_distance + 0.792845))) + 0.5 * 0.0298352 * act_delta)
    }
    if ((current_distance > 0.0) && (enclose() < max_enclose) && (enclose() >= current_distance)) {
	model = 6
	       	cr = (0.0373792 * (1 - exp(--15.676 * (act_distance + -117.116))) * pow(act_width , 0.00198816 * act_distance + 0.117022))
    	dcdp1 = (0.00462803 * (1 - exp(-1000 * (act_distance + 1000))) * pow(act_width , -0.00156957 * act_distance + 0.535685) ) 
    	dcdub = (0.00462803 * (1 - exp(-1000 * (act_distance + 1000))) * pow(act_width , -0.00156957 * act_distance + 0.535685) )
        C = current_length * ( cr + 0.5 * 0.0298352 * act_delta) 
        dcdp1 = current_length * ( dcdp1 + 0.5 * 0.0325107 * act_delta) 
        dcdub = current_length * ( dcdub + 0.5 * 0.0325107 * act_delta) 
    }
    if ((current_distance <= 0.0) && (enclose() < max_enclose)) {
	model = 26
        C = current_length * (0.5 * (1.86913e-06 * new_max_caldist + 0.166137) * (0.716626 - exp(-(0.00015276 * new_max_caldist + 0.184563) * (act_enclose + -0.0023849 * new_max_caldist + 4.46395) - (8.78244e-05 * new_max_caldist + -0.00984742) * (act_enclose + 0.000802847 * new_max_caldist + 0.792845) * (act_enclose + 0.000802847 * new_max_caldist + 0.792845))) + 0.5 * 0.0298352 * act_delta)
    }
    if ((current_distance > 0.0) && (enclose() < EPS_ENC) && (enclose() >= 0) && (radius_up() < max_radius) && (radius_down() >= max_radius)) {
	model = 114	
        C = current_length * (0.161819 * (1.0 - exp( -0.0560744 * (act_distance + 61.7146))) * pow(act_width,7.7812e-07 * act_distance + 0.000271901) * pow(radius_up(),0.00399262) + 0.5 * 0.0298352 * act_delta)
    }
    if ((current_distance <= 0.0) && (enclose() < max_enclose) && (enclose() >= 0) && (radius_up() >= max_radius) && (radius_down() >= max_radius) && (radius_up_behind() >= max_radius) && (radius_down_behind() >= max_radius)) {
	model = 11
        C = current_length * (0.0391645 * pow(act_width , 0.164986) * (1.0 - exp(-0.262457 * (act_enclose + 2.23001))) + 0.5 * 0.0298352 * act_delta)
	dcdp1 = current_length * (0.00730198 * pow(act_width, 0.284446) * (1.0 - exp(-4.6533 * (act_enclose + 0.12926))) + 0.5 * 0.0325107 * act_delta)
	dcdub = current_length * (0.00730198 * pow(act_width, 0.284446) * (1.0 - exp(-4.6533 * (act_enclose + 0.12926))) + 0.5 * 0.0325107 * act_delta)
    }
    if ((act_width >= radius_up_behind()) && (radius_up() < max_radius) && (radius_down() >= max_radius) && (radius_up_behind() < max_radius) && (radius_down_behind() >= max_radius)) {
	model = 19
        C = current_length * (0.0748662 * (1.0 - exp( -0.0129123 * (radius_up() + 21.0909))) * (1.0 - exp( -1000 * (radius_up_behind() + 4.64678e-05))) + 0.5 * 0.0298352 * act_delta)
    }
    mydistshield = 2 * current_distance + current_width
    mydistb = current_distance + current_width 
    vdsh = 10 * distance_shield()
    vdb = 10 * distance_behind()
    if ((current_distance > 0.0) && (enclose() >= max_enclose) && (distance_shield() <= mydistshield) && (distance_behind() <= mydistb) && (vdsh < height) && (vdb < height)) {
        C = CFR_MUL_36 * C 
    }
    if (C < 0.0) {
        C = 0
    }
    if (dcdp1 < 0.0) {
        dcdp1 = 0
    }
    if (dcdub < 0.0) {
        dcdub = 0
    }
    maxw = 60
    maxd = 1202.5
    upw = upper_loading() 
    if (THK_D_ACT_XCALIBRATE__MC > 0 ) {
        bval = lookup1 ("THICKNESS_D_ACT",layer2(), corner,upw,upw)
        bmax = lookup1 ("THICKNESS_D_ACT",layer2(), corner,maxw,maxd)
    } else {	
        bval = lookup1 ("THICKNESS_D",layer2(), corner,upw,upw)
        bmax = lookup1 ("THICKNESS_D",layer2(), corner,maxw,maxd)
    }	
    if (PLATE_LOADING > 0) {
	    C = C - dcdp1 * dp1val - dcdub * bval - 0.5 * (bval - bmax) * LOADING_FACTOR * current_length * current_width * 0.0325107 
    } else {
	    C = C - dcdp1 * dp1val
    }
    if (C < 0) {
	C = 0
    }
    C = C * scaleunits
]

#ENDCRYPT


#ENCRYPT
//
//  model: 36  target: intrinsic  profile: ultra layers: ultra_base,XCALIBRATE__M1,XCALIBRATE__MC
//
CAPACITANCE INTRINSIC FRINGE XCALIBRATE__M1 INSIDE OF XCALIBRATE__MC MASK
[
    PROPERTY C
    max_calwidth = 60 // For reference
    max_caldistance = 1202.5 // For reference
    max2_calwidth = 28 // For reference
    max2_caldistance = 642.63 // For reference
    min_calwidth = 12 // For reference
    min_caldistance = 8 // For reference
    max_width = MAXWIDTH_XCALIBRATE__M1
    max_distance = MAXDISTANCE_XCALIBRATE__M1
    max_enclose = MAXENCLOSE_XCALIBRATE__M1
    max_radius = MAXRADIUS_XCALIBRATE__M1
    scaleunits = 1e-15/1e-15
    profile = ultra_profileid
    dm1(1) = {0}
	current_width = width()
	current_width2 = width2()
	corner = corner_index()
    dm1val = get_value ("dm1", corner)
    if (distance() <= 0.0) {
	dist = max_caldistance
    } else {
	dist = distance()
    }
    distb = distance_behind() - current_width
    if (MULTI_BIAS_XCALIBRATE__M1 > 0 ) {
        act_delta_right = lookup1 (bias1_tbl(),layer1(), corner, current_width, dist)
    	act_delta_left = lookup1 (bias1_tbl(),layer1(), corner, current_width, distb)
    	act_delta2 = lookup1 (bias1_tbl(),layer1(), corner, current_width2, dist)
    	act_delta = (act_delta_left + act_delta_right)
    	act_width1 = current_width + act_delta
    	act_width2 = current_width2 + 2 * act_delta2
    	act_dist = dist - (act_delta_right + act_delta2)
    	act_distb = distb - 2 * act_delta_left 
    	act_up = inside_up() - act_delta_right
    	act_delta_right = lookup1 (bias2_tbl(),layer1(), corner, act_width1, act_dist)
    	act_delta_left = lookup1 (bias2_tbl(),layer1(), corner, act_width1, act_distb)
    	act_delta2 = lookup1 (bias2_tbl(),layer1(), corner, act_width2, act_dist)
    	act_delta = act_delta + (act_delta_left + act_delta_right)
    	act_width = current_width + act_delta
    	act_distance = act_dist - (act_delta_right + act_delta2)
    	act_distb = act_distb - 2 * act_delta_left 
    	act_in_up = act_up - act_delta_right
    } else {
    	act_delta_right = lookup1 (delta_tbl(),layer1(), corner, current_width, dist)
    	act_delta_left = lookup1 (delta_tbl(),layer1(), corner, current_width, distb)
    	act_delta2 = lookup1 (delta_tbl(),layer1(), corner, current_width2, dist)
    	act_delta = 0.5 * (act_delta_left + act_delta_right)
        act_width = current_width + act_delta 
        act_distance = dist - 0.5 * (act_delta_right + act_delta2)
        act_distb = distb - act_delta_left
    	act_in_up = inside_up() - act_delta_right / 2.0
    }
 	if ( mask_offset() != -1 ) { 
    act_distance = act_distance + mask_offset()
	} 
    nrval = 0 
    nlval = 0 
    rval = 0 
    lval = 0 
    if ( PEX_USE_K_VARIATION > 0 ) { 
 	if ( PEX_XCALIBRATE__M1_USE_BOTTOM_K_VARIATION > 0 ) { 
	nrval = lookup1 ("BOTTOM_K",layer1(), 0,current_width, dist) 
 	nlval = lookup1 ("BOTTOM_K",layer1(), 0,current_width, distb) 
 	rval = lookup1 ("BOTTOM_K",layer1(), corner,current_width, dist) 
 	lval = lookup1 ("BOTTOM_K",layer1(), corner,current_width, distb) 
	act_width  = act_width + current_width*((rval+lval)/(nrval+nlval)-1) 
    } 
	} 
    if (act_distance < min_caldistance) {
	act_distance = min_caldistance	
    }
    if (act_width < min_calwidth) {
	act_width = min_calwidth	
    }
    if (act_in_up < 0) {
	act_in_up = 0
    }
    model = 36
    C = 0.0
    didm1 = 0.0
    dcdb  = 0.0
	current_distance = distance()
	current_length = length()
    if ((current_distance > 0.0) && (same_net() == 0)) {
	model = 6 
	   if(act_distance >= 11832.5 ) {
				max_thr_distance = 11832.5 
				value1 = (0.0199871 * (1 - exp(-0.860976 * (max2_caldistance + -1.00637))) * pow(act_width , 0.00111903 * max2_caldistance + -1.78325) )
				value2 = (0.0199871 * (1 - exp(-0.860976 * (max_caldistance + -1.00637))) * pow(act_width , 0.00111903 * max_caldistance + -1.78325) )
	  			intr = value1 - (value2 - value1) * ((max2_caldistance - act_distance) / (max2_caldistance - max_caldistance))
				didm1 = (-7.97448e-05 * (1 - exp(--1.95788e-05 * (max_thr_distance + 2.83258))) * pow(act_width , -2.0809 * max_thr_distance + 5) )
				dcdb  = (-7.97448e-05 * (1 - exp(--1.95788e-05 * (max_thr_distance + 2.83258))) * pow(act_width , -2.0809 * max_thr_distance + 5) )
			}
			else {
				intr = (0.0199871 * (1 - exp(-0.860976 * (act_distance + -1.00637))) * pow(act_width , 0.00111903 * act_distance + -1.78325) )
				didm1 = (-7.97448e-05 * (1 - exp(--1.95788e-05 * (act_distance + 2.83258))) * pow(act_width , -2.0809 * act_distance + 5) )
				dcdb  = (-7.97448e-05 * (1 - exp(--1.95788e-05 * (act_distance + 2.83258))) * pow(act_width , -2.0809 * act_distance + 5) )
			}
        C = current_length * ( intr + 0.5 * 4.4271e-05 * act_delta) 
        didm1 = current_length * ( didm1 + 0.5 * 4.43821e-08 * act_delta) 
        dcdb = current_length * ( dcdb + 0.5 * 4.43821e-08 * act_delta)
    }
    if ((current_distance > 0.0) && (same_net() == 1)) {
	model = 60
        C = current_length * (0.000121036 * (1 - exp(-0.209696 * (act_distance + 1.89627)))+ 0.5 * 4.4271e-05 * act_delta)
    }
    if (current_distance <= 0.0) {
	model = 8
        C = current_length * (4.54861e-05 * pow(act_width , 0.380285)+ 0.5 * 4.4271e-05 * act_delta)
	didm1 = current_length * (5.10284e-08 * pow(act_width , 0.339349) + 0.5 * 4.43821e-08 * act_delta)
	dcdb  = current_length * (5.10284e-08 * pow(act_width , 0.339349) + 0.5 * 4.43821e-08 * act_delta)
    }
    if ((current_distance > 0.0) && (inside_up() < EPS_ENC) && (inside_up() >= 0) && (radius_up() < max_radius) && (radius_down() >= max_radius))  {
	model = 114
        C = current_length * (0.0072127 * (1.0 - exp( -0.0146149 * (act_distance + 129.362))) * pow(act_width,2.37785e-05 * act_distance + -0.0897668) * pow(radius_up(),0.0441192)+ 0.5 * 4.4271e-05 * act_delta)
    }
    if ((current_distance > 0.0) && (distance_behind() > 0.0) && (inside_up() < EPS_ENC) && (inside_up() >= 0) && (radius_up() < max_radius) && (radius_down() >= max_radius) && (radius_down_behind() >= max_radius))  {
        model = 1114
        C = current_length * (4.34482 * (1.0 - exp( -0.0360051 * (act_distance + 27.6772))) * pow(act_width,-5.71261e-05 * act_distance + 0.0185393) * pow(radius_up(),0.0989365) * (1.0 - 0.999573 * exp( -1.96532e-06 * act_distb / min_caldistance)) + 0.5 * 4.4271e-05 * act_delta)
        
        if(distance_shield() > 0 && distance_shield() <= 1.5 * (min_calwidth + min_caldistance) ) {
            C = XCAL_M1114_F * C
        }
        
    }
    if ((current_distance <= 0.0) && (inside_up() < max_enclose) && (inside_up() >= 0) && (radius_up() >= max_radius) && (radius_down() >= max_radius) && (radius_up_behind() >= max_radius) && (radius_down_behind() >= max_radius))  {
	model = 11
        C = (0.00415521 * pow(act_width,0.49707) * exp(-0.0274321 * (act_in_up + 29.6761)))
        C = current_length * (C + 0.5 * 4.4271e-05 * act_delta)
	didm1 = current_length * (3.73217e-06 * pow(act_width,0.344336) * exp(-0.0396796 * (act_in_up + 45.6345)) + 0.5 * 4.43821e-08 * act_delta)
	dcdb  = current_length * (3.73217e-06 * pow(act_width,0.344336) * exp(-0.0396796 * (act_in_up + 45.6345)) + 0.5 * 4.43821e-08 * act_delta)
    }   
    if (C < 0) {
	C = 0
    }
    if (didm1 < 0) {
	didm1 = 0
    }	
    if (THK_D_ACT_XCALIBRATE__M1 > 0 ) {
	bval = lookup1 ("THICKNESS_D_ACT",layer1(), corner,act_width, act_distance)
        bmax = lookup1 ("THICKNESS_D_ACT",layer1(), corner, max_calwidth, max_caldistance)
    } else {	
	bval = lookup1 ("THICKNESS_D",layer1(), corner,current_width, dist)
        bmax = lookup1 ("THICKNESS_D",layer1(), corner,max_calwidth, max_caldistance)
    }	
    if (PLATE_LOADING > 0) {
	    C = C - (didm1 * dm1val) - (dcdb * bval) - 0.5 * (bval - bmax) * LOADING_FACTOR * current_length * current_width * 4.43821e-08
    } else {
	    C = C - (didm1 * dm1val) - (dcdb * bval) - 0.5 * bval * current_length * current_width * 4.43821e-08
    }
    C = C * scaleunits
]

#ENDCRYPT


#ENCRYPT
//
//  model: 36  target: nearbody  profile: ultra layers: ultra_base,XCALIBRATE__M2,XCALIBRATE__MC
//
CAPACITANCE NEARBODY XCALIBRATE__M2 INSIDE OF XCALIBRATE__MC MASK
[
    PROPERTY C
    max_calwidth = 60 // For reference
    max_caldistance = 1206 // For reference
    min_calwidth = 12 // For reference
    min_caldistance = 8 // For reference
    max_width = MAXWIDTH_XCALIBRATE__M2
    max_distance = MAXDISTANCE_XCALIBRATE__M2
    max_enclose = MAXENCLOSE_XCALIBRATE__M2
    max_radius = MAXRADIUS_XCALIBRATE__M2
    scaleunits = 1e-15/1e-15
    profile = ultra_profileid
    dt(1) = {0}
	current_width1 = width1()
	current_width2 = width2()
	corner = corner_index()
	current_distance = distance()
    dtval = get_value ("dt", corner)
    cor_thickness = lookup1 ("NOM_THICKNESS",layer1(), corner, -1, -1)
    dtindie = thickness1() - cor_thickness
    distanceb = distance_behind() - current_width1
    if (MULTI_BIAS_XCALIBRATE__M2 > 0 ) {
    	act_delta_right = lookup1 (bias1_tbl(),layer1(), corner, current_width1, current_distance)
    	act_delta_left = lookup1 (bias1_tbl(),layer1(), corner, current_width1, distanceb)
    	act_delta = lookup1 (bias1_tbl(),layer1(), corner, current_width2, current_distance)
    	act_width1 = current_width1 + (act_delta_left + act_delta_right)
    	act_width2 = current_width2 + 2 * act_delta
    	act_distance1 = current_distance - (act_delta_right + act_delta)
    	act_distanceb = distanceb - 2 * act_delta_left 
    	act_delta_right = lookup1 (bias2_tbl(),layer1(), corner, act_width1, act_distance1)
    	act_delta_left = lookup1 (bias2_tbl(),layer1(), corner, act_width1, act_distanceb)
    	act_delta = lookup1 (bias2_tbl(),layer1(), corner, act_width2, act_distance1)
    	act_distance = act_distance1 - (act_delta_right + act_delta) 
    	act_width12 = act_width1 + (act_delta_left + act_delta_right)
    	act_width22 = act_width2 + 2 * act_delta
    	act_width = 2 * act_width12 * act_width22 / (act_width12 + act_width22)
    } else {
    	act_delta_right = lookup1 (delta_tbl(),layer1(), corner, current_width1, current_distance)
    	act_delta_left = lookup1 (delta_tbl(),layer1(), corner, current_width1, distanceb)
    	act_delta = lookup1 (delta_tbl(),layer1(), corner, current_width2, current_distance)
    	act_width1 = current_width1 + 0.5 * (act_delta_left + act_delta_right)
    	act_width2 = current_width2 + act_delta
    	act_distance = current_distance - 0.5 * (act_delta_right + act_delta)
    	act_width = 2 * act_width1 * act_width2 / (act_width1 + act_width2)
    }
 	if ( mask_offset() != -1 ) { 
    act_distance = act_distance + mask_offset()
	} 
    if (act_distance < min_caldistance) {
	act_distance = min_caldistance	
    }
    if (act_width < min_calwidth) {
	act_width = min_calwidth	
    }
    nval = 0 
    sval = 0 
    if ( PEX_USE_K_VARIATION > 0 ) { 
 	if ( PEX_XCALIBRATE__M2_USE_SIDEWALL_K_VARIATION > 0 ) { 
 	   if ( mask_offset() == -1 ) { 
	      if (PEX_XCALIBRATE__M2_SIDEWALL_K_DRAWN > 0) {
	         nval = lookup1 ("SIDEWALL_K",layer1(), 0, current_width1, current_distance) 
 	         sval = lookup1 ("SIDEWALL_K",layer1(), corner,current_width1, current_distance) 
	      } else { 
 	         nval = lookup1 ("SIDEWALL_K_ACT",layer1(), 0, act_width, act_distance) 
  	         sval = lookup1 ("SIDEWALL_K_ACT",layer1(), corner,act_width, act_distance) 
	      } 
 	      dtindie  = dtindie + thickness1() * ((sval/nval) - 1) 
	   } 
        } 
    } 
    model = 36
    model = 6
        nb =  (0.00190704*exp(-0.140667 * act_distance) + 0.00255323 * pow(act_distance , -0.415447)) * pow(act_width , 0.659882)
    dndt = ((0.0105094*exp(-0.101197 * act_distance ) + 0.005 * pow(act_distance,-45.9634))*pow(act_width, 0.13275))
    current_length = length()
    C = current_length * nb 
    dndt = current_length * dndt 
    if( distance_shield() > 0 ) {
    	nbr = 1
    	if (nbr < 0.97 ) {
	    nbr = 0.97
	} else if ( nbr > 1 ) {
	    nbr = 1
	}
    	C = C * nbr
    }
    if ((inside_up() < EPS_ENC) && (inside_up() >= 0) && (radius_up() < max_radius) && (radius_down() >= max_radius)) {
	model = 114
	C = current_length * (exp(-4.58941 - 0.0029002 * act_distance ) + 0.260916 / pow(act_distance,0.722368)) * 0.161594 * pow(act_width, 0.161018) * pow(radius_up(),0.115551)
	dndt = 0
    }
    C = C + dndt * (dtval + dtindie)
    C = C * scaleunits
]

#ENDCRYPT


#ENCRYPT
//
//  model: 36  target: crossovere  profile: ultra layers: ultra_base,XCALIBRATE__M2,XCALIBRATE__MC
//
CAPACITANCE CROSSOVER FRINGE XCALIBRATE__M2 XCALIBRATE__MC MASK
[
    PROPERTY C
    max_calwidth = 60 // For reference
    max2_calwidth = 28 // For reference
    max_caldistance = 1206 // For reference
    max2_caldistance = 644.266 // For reference
    max_calenclose = 1206 // For reference
    min_calwidth = 12 // For reference
    min_caldistance = 8 // For reference
    max_width = MAXWIDTH_XCALIBRATE__M2
    max_distance = MAXDISTANCE_XCALIBRATE__M2
    max_enclose = MAXENCLOSE_XCALIBRATE__M2
    max_radius = MAXRADIUS_XCALIBRATE__M2
    scaleunits = 1e-15/1e-15
    profile = ultra_profileid
    height = 0.3
    dp1(1) = {0}
	current_width = width()
	current_width2 = width2()
	corner = corner_index()
    dp1val = get_value ("dp1", corner)
    if (distance() <= 0.0) {
	dist = max_caldistance
    } else {
	dist = distance()
    }
    distb = distance_behind() - current_width
    if (MULTI_BIAS_XCALIBRATE__M2 > 0 ) {
    	act_delta_right = lookup1 (bias1_tbl(),layer1(), corner, current_width, dist)
    	act_delta_left = lookup1 (bias1_tbl(),layer1(), corner, current_width, distb)
    	act_delta2 = lookup1 (bias1_tbl(),layer1(), corner, current_width2, dist)
    	act_delta = (act_delta_left + act_delta_right)
    	act_width1 = current_width + act_delta
    	act_width2 = current_width2 + 2 * act_delta2
    	act_dist = dist - (act_delta_right + act_delta2)
    	act_distb = distb - 2 * act_delta_left
    	act_enclose = enclose() - act_delta_right
    	act_delta_right = lookup1 (bias2_tbl(),layer1(), corner, act_width1, act_dist)
    	act_delta_left = lookup1 (bias2_tbl(),layer1(), corner, act_width1, act_distb)
    	act_delta2 = lookup1 (bias2_tbl(),layer1(), corner, act_width2, act_dist)
    	act_delta = act_delta + (act_delta_left + act_delta_right)
    	act_width = current_width + act_delta
    	act_distance = act_dist - (act_delta_right + act_delta2)
    	act_enclose = act_enclose - act_delta_right 
    } else {
    	act_delta_right = lookup1 (delta_tbl(),layer1(), corner, current_width, dist)
    	act_delta_left = lookup1 (delta_tbl(),layer1(), corner, current_width, distb)
    	act_delta2 = lookup1 (delta_tbl(),layer1(), corner, current_width2, dist)
    	act_delta = 0.5 * (act_delta_left + act_delta_right)
   	act_enclose = enclose() - 0.5 * act_delta_right
        act_width = current_width + act_delta 
        act_distance = dist - 0.5 * (act_delta_right + act_delta2)
    }	
 	if ( mask_offset() != -1 ) { 
    act_distance = act_distance + mask_offset()
	} 
    if (act_distance < min_caldistance) {
	act_distance = min_caldistance	
    }
    if (act_width < min_calwidth) {
	act_width = min_calwidth	
    }
    if (act_enclose < 0) {
	act_enclose = 0
    }
    model = 36
    C = 0.0
    dcdp1 = 0.0
    dcdub = 0.0
    new_max_caldist = 2.5 * max_caldistance
	current_distance = distance()
	current_length = length()
    if ((current_distance > 0.0) && (same_net() == 0) && (enclose() >= max_enclose)) {
	model = 6
	       	cr = (0.038468 * (1 - exp(-5.47851 * (act_distance + -3.12191))) * pow(act_width , 0.0043515 * act_distance + 0.142073))
    	dcdp1 = (0.0136947 * (1 - exp(-0.0590684 * (act_distance + 95.64))) * pow(act_width , -0.00210385 * act_distance + 0.579872) ) 
    	dcdub = (0.0136947 * (1 - exp(-0.0590684 * (act_distance + 95.64))) * pow(act_width , -0.00210385 * act_distance + 0.579872) )
        C = current_length * ( cr + 0.5 * 0.091496 * act_delta) 
        dcdp1 = current_length * ( dcdp1 + 0.5 * 0.30575 * act_delta) 
        dcdub = current_length * ( dcdub + 0.5 * 0.30575 * act_delta) 
    }
    if ((current_distance > 0.0) && (same_net() == 1) && (enclose() >= max_enclose)) {
	model = 60
        C = current_length * (0.0731503 * (1 - exp(-0.0728783 * (act_distance + 17.2472))) + 0.5 * 0.091496 * act_delta)
    }
    if ((current_distance <= 0.0) && (enclose() >= max_enclose)) {
	model = 8	
        C = current_length * (0.0408026 * pow(act_width , 0.211021) + 0.5 * 0.091496 * act_delta)
	dcdp1 = current_length * (0.0183666 * pow(act_width, 0.406545) + 0.5 * 0.30575 * act_delta)
	dcdub = current_length * (0.0183666 * pow(act_width, 0.406545) + 0.5 * 0.30575 * act_delta)
    }
    if ((current_distance > 0.0) && (enclose() < max_enclose) && (enclose() < current_distance)) {
	model = 26
        C = current_length * (0.5 * (2.0193e-06 * act_distance + 0.16155) * (0.831711 - exp(-(-3.18008e-07 * act_distance + 0.337615) * (act_enclose + -0.00837268 * act_distance + 2.61103) - (0.00208272 * act_distance + -0.0382655) * (act_enclose + 4.04451e-07 * act_distance + 1.15489) * (act_enclose + 4.04451e-07 * act_distance + 1.15489))) + 0.5 * 0.091496 * act_delta)
    }
    if ((current_distance > 0.0) && (enclose() < max_enclose) && (enclose() >= current_distance)) {
	model = 6
	       	cr = (0.038468 * (1 - exp(-5.47851 * (act_distance + -3.12191))) * pow(act_width , 0.0043515 * act_distance + 0.142073))
    	dcdp1 = (0.0136947 * (1 - exp(-0.0590684 * (act_distance + 95.64))) * pow(act_width , -0.00210385 * act_distance + 0.579872) ) 
    	dcdub = (0.0136947 * (1 - exp(-0.0590684 * (act_distance + 95.64))) * pow(act_width , -0.00210385 * act_distance + 0.579872) )
        C = current_length * ( cr + 0.5 * 0.091496 * act_delta) 
        dcdp1 = current_length * ( dcdp1 + 0.5 * 0.30575 * act_delta) 
        dcdub = current_length * ( dcdub + 0.5 * 0.30575 * act_delta) 
    }
    if ((current_distance <= 0.0) && (enclose() < max_enclose)) {
	model = 26
        C = current_length * (0.5 * (2.0193e-06 * new_max_caldist + 0.16155) * (0.831711 - exp(-(-3.18008e-07 * new_max_caldist + 0.337615) * (act_enclose + -0.00837268 * new_max_caldist + 2.61103) - (0.00208272 * new_max_caldist + -0.0382655) * (act_enclose + 4.04451e-07 * new_max_caldist + 1.15489) * (act_enclose + 4.04451e-07 * new_max_caldist + 1.15489))) + 0.5 * 0.091496 * act_delta)
    }
    if ((current_distance > 0.0) && (enclose() < EPS_ENC) && (enclose() >= 0) && (radius_up() < max_radius) && (radius_down() >= max_radius)) {
	model = 114	
        C = current_length * (0.459732 * (1.0 - exp( -0.0546423 * (act_distance + 83.9626))) * pow(act_width,2.69013e-07 * act_distance + -6.85794e-05) * pow(radius_up(),0.00134948) + 0.5 * 0.091496 * act_delta)
    }
    if ((current_distance <= 0.0) && (enclose() < max_enclose) && (enclose() >= 0) && (radius_up() >= max_radius) && (radius_down() >= max_radius) && (radius_up_behind() >= max_radius) && (radius_down_behind() >= max_radius)) {
	model = 11
        C = current_length * (0.0432633 * pow(act_width , 0.176673) * (1.0 - exp(-0.331369 * (act_enclose + 1.9491))) + 0.5 * 0.091496 * act_delta)
	dcdp1 = current_length * (0.0185974 * pow(act_width, 0.408429) * (1.0 - exp(-2.75194 * (act_enclose + 0.273305))) + 0.5 * 0.30575 * act_delta)
	dcdub = current_length * (0.0185974 * pow(act_width, 0.408429) * (1.0 - exp(-2.75194 * (act_enclose + 0.273305))) + 0.5 * 0.30575 * act_delta)
    }
    if ((act_width >= radius_up_behind()) && (radius_up() < max_radius) && (radius_down() >= max_radius) && (radius_up_behind() < max_radius) && (radius_down_behind() >= max_radius)) {
	model = 19
        C = current_length * (122.371 * (1.0 - exp( -1000 * (radius_up() + 1000))) * (1.0 - exp( -1000 * (radius_up_behind() + 1000))) + 0.5 * 0.091496 * act_delta)
    }
    mydistshield = 2 * current_distance + current_width
    mydistb = current_distance + current_width 
    vdsh = 10 * distance_shield()
    vdb = 10 * distance_behind()
    if ((current_distance > 0.0) && (enclose() >= max_enclose) && (distance_shield() <= mydistshield) && (distance_behind() <= mydistb) && (vdsh < height) && (vdb < height)) {
        C = CFR_MUL_36 * C 
    }
    if (C < 0.0) {
        C = 0
    }
    if (dcdp1 < 0.0) {
        dcdp1 = 0
    }
    if (dcdub < 0.0) {
        dcdub = 0
    }
    maxw = 60
    maxd = 1202.5
    upw = upper_loading() 
    if (THK_D_ACT_XCALIBRATE__MC > 0 ) {
        bval = lookup1 ("THICKNESS_D_ACT",layer2(), corner,upw,upw)
        bmax = lookup1 ("THICKNESS_D_ACT",layer2(), corner,maxw,maxd)
    } else {	
        bval = lookup1 ("THICKNESS_D",layer2(), corner,upw,upw)
        bmax = lookup1 ("THICKNESS_D",layer2(), corner,maxw,maxd)
    }	
    if (PLATE_LOADING > 0) {
	    C = C - dcdp1 * dp1val - dcdub * bval - 0.5 * (bval - bmax) * LOADING_FACTOR * current_length * current_width * 0.30575 
    } else {
	    C = C - dcdp1 * dp1val
    }
    if (C < 0) {
	C = 0
    }
    C = C * scaleunits
]

#ENDCRYPT


#ENCRYPT
//
//  model: 36  target: intrinsic  profile: ultra layers: ultra_base,XCALIBRATE__M2,XCALIBRATE__MC
//
CAPACITANCE INTRINSIC FRINGE XCALIBRATE__M2 INSIDE OF XCALIBRATE__MC MASK
[
    PROPERTY C
    max_calwidth = 60 // For reference
    max_caldistance = 1206 // For reference
    max2_calwidth = 28 // For reference
    max2_caldistance = 644.266 // For reference
    min_calwidth = 12 // For reference
    min_caldistance = 8 // For reference
    max_width = MAXWIDTH_XCALIBRATE__M2
    max_distance = MAXDISTANCE_XCALIBRATE__M2
    max_enclose = MAXENCLOSE_XCALIBRATE__M2
    max_radius = MAXRADIUS_XCALIBRATE__M2
    scaleunits = 1e-15/1e-15
    profile = ultra_profileid
    dm1(1) = {0}
	current_width = width()
	current_width2 = width2()
	corner = corner_index()
    dm1val = get_value ("dm1", corner)
    if (distance() <= 0.0) {
	dist = max_caldistance
    } else {
	dist = distance()
    }
    distb = distance_behind() - current_width
    if (MULTI_BIAS_XCALIBRATE__M2 > 0 ) {
        act_delta_right = lookup1 (bias1_tbl(),layer1(), corner, current_width, dist)
    	act_delta_left = lookup1 (bias1_tbl(),layer1(), corner, current_width, distb)
    	act_delta2 = lookup1 (bias1_tbl(),layer1(), corner, current_width2, dist)
    	act_delta = (act_delta_left + act_delta_right)
    	act_width1 = current_width + act_delta
    	act_width2 = current_width2 + 2 * act_delta2
    	act_dist = dist - (act_delta_right + act_delta2)
    	act_distb = distb - 2 * act_delta_left 
    	act_up = inside_up() - act_delta_right
    	act_delta_right = lookup1 (bias2_tbl(),layer1(), corner, act_width1, act_dist)
    	act_delta_left = lookup1 (bias2_tbl(),layer1(), corner, act_width1, act_distb)
    	act_delta2 = lookup1 (bias2_tbl(),layer1(), corner, act_width2, act_dist)
    	act_delta = act_delta + (act_delta_left + act_delta_right)
    	act_width = current_width + act_delta
    	act_distance = act_dist - (act_delta_right + act_delta2)
    	act_distb = act_distb - 2 * act_delta_left 
    	act_in_up = act_up - act_delta_right
    } else {
    	act_delta_right = lookup1 (delta_tbl(),layer1(), corner, current_width, dist)
    	act_delta_left = lookup1 (delta_tbl(),layer1(), corner, current_width, distb)
    	act_delta2 = lookup1 (delta_tbl(),layer1(), corner, current_width2, dist)
    	act_delta = 0.5 * (act_delta_left + act_delta_right)
        act_width = current_width + act_delta 
        act_distance = dist - 0.5 * (act_delta_right + act_delta2)
        act_distb = distb - act_delta_left
    	act_in_up = inside_up() - act_delta_right / 2.0
    }
 	if ( mask_offset() != -1 ) { 
    act_distance = act_distance + mask_offset()
	} 
    nrval = 0 
    nlval = 0 
    rval = 0 
    lval = 0 
    if ( PEX_USE_K_VARIATION > 0 ) { 
 	if ( PEX_XCALIBRATE__M2_USE_BOTTOM_K_VARIATION > 0 ) { 
	nrval = lookup1 ("BOTTOM_K",layer1(), 0,current_width, dist) 
 	nlval = lookup1 ("BOTTOM_K",layer1(), 0,current_width, distb) 
 	rval = lookup1 ("BOTTOM_K",layer1(), corner,current_width, dist) 
 	lval = lookup1 ("BOTTOM_K",layer1(), corner,current_width, distb) 
	act_width  = act_width + current_width*((rval+lval)/(nrval+nlval)-1) 
    } 
	} 
    if (act_distance < min_caldistance) {
	act_distance = min_caldistance	
    }
    if (act_width < min_calwidth) {
	act_width = min_calwidth	
    }
    if (act_in_up < 0) {
	act_in_up = 0
    }
    model = 36
    C = 0.0
    didm1 = 0.0
    dcdb  = 0.0
	current_distance = distance()
	current_length = length()
    if ((current_distance > 0.0) && (same_net() == 0)) {
	model = 6 
	   if(act_distance >= 5152.02 ) {
				max_thr_distance = 5152.02 
				value1 = (3.63919e-05 * (1 - exp(--23.2618 * (max2_caldistance + -19.2547))) * pow(act_width , 0.0424221 * max2_caldistance + -0.170563) )
				value2 = (3.63919e-05 * (1 - exp(--23.2618 * (max_caldistance + -19.2547))) * pow(act_width , 0.0424221 * max_caldistance + -0.170563) )
	  			intr = value1 - (value2 - value1) * ((max2_caldistance - act_distance) / (max2_caldistance - max_caldistance))
				didm1 = (-1.09617e-05 * (1 - exp(-2.91649e-05 * (max_thr_distance + -6.50987))) * pow(act_width , 0.0871611 * max_thr_distance + -0.272032) )
				dcdb  = (-1.09617e-05 * (1 - exp(-2.91649e-05 * (max_thr_distance + -6.50987))) * pow(act_width , 0.0871611 * max_thr_distance + -0.272032) )
			}
			else {
				intr = (3.63919e-05 * (1 - exp(--23.2618 * (act_distance + -19.2547))) * pow(act_width , 0.0424221 * act_distance + -0.170563) )
				didm1 = (-1.09617e-05 * (1 - exp(-2.91649e-05 * (act_distance + -6.50987))) * pow(act_width , 0.0871611 * act_distance + -0.272032) )
				dcdb  = (-1.09617e-05 * (1 - exp(-2.91649e-05 * (act_distance + -6.50987))) * pow(act_width , 0.0871611 * act_distance + -0.272032) )
			}
        C = current_length * ( intr + 0.5 * 4.4232e-05 * act_delta) 
        didm1 = current_length * ( didm1 + 0.5 * 4.43153e-08 * act_delta) 
        dcdb = current_length * ( dcdb + 0.5 * 4.43153e-08 * act_delta)
    }
    if ((current_distance > 0.0) && (same_net() == 1)) {
	model = 60
        C = current_length * (5.36405e-05 * (1 - exp(-0.256677 * (act_distance + 1.76895)))+ 0.5 * 4.4232e-05 * act_delta)
    }
    if (current_distance <= 0.0) {
	model = 8
        C = current_length * (2.03866e-05 * pow(act_width , 0.366514)+ 0.5 * 4.4232e-05 * act_delta)
	didm1 = current_length * (2.71403e-08 * pow(act_width , 0.327975) + 0.5 * 4.43153e-08 * act_delta)
	dcdb  = current_length * (2.71403e-08 * pow(act_width , 0.327975) + 0.5 * 4.43153e-08 * act_delta)
    }
    if ((current_distance > 0.0) && (inside_up() < EPS_ENC) && (inside_up() >= 0) && (radius_up() < max_radius) && (radius_down() >= max_radius))  {
	model = 114
        C = current_length * (0.00623393 * (1.0 - exp( -0.0123121 * (act_distance + 148.615))) * pow(act_width,2.80609e-05 * act_distance + -0.109653) * pow(radius_up(),0.0541713)+ 0.5 * 4.4232e-05 * act_delta)
    }
    if ((current_distance > 0.0) && (distance_behind() > 0.0) && (inside_up() < EPS_ENC) && (inside_up() >= 0) && (radius_up() < max_radius) && (radius_down() >= max_radius) && (radius_down_behind() >= max_radius))  {
        model = 1114
        C = current_length * (0.0259506 * (1.0 - exp( -0.0338388 * (act_distance + 29.7798))) * pow(act_width,-5.09637e-05 * act_distance + 0.0293551) * pow(radius_up(),0.1201) * (1.0 - 0.945663 * exp( -0.000291172 * act_distb / min_caldistance)) + 0.5 * 4.4232e-05 * act_delta)
        
        if(distance_shield() > 0 && distance_shield() <= 1.5 * (min_calwidth + min_caldistance) ) {
            C = XCAL_M1114_F * C
        }
        
    }
    if ((current_distance <= 0.0) && (inside_up() < max_enclose) && (inside_up() >= 0) && (radius_up() >= max_radius) && (radius_down() >= max_radius) && (radius_up_behind() >= max_radius) && (radius_down_behind() >= max_radius))  {
	model = 11
        C = (0.00268755 * pow(act_width,0.556949) * exp(-0.0284455 * (act_in_up + 26.1707)))
        C = current_length * (C + 0.5 * 4.4232e-05 * act_delta)
	didm1 = current_length * (5.28524e-06 * pow(act_width,0.3631) * exp(-0.0496802 * (act_in_up + 48.8448)) + 0.5 * 4.43153e-08 * act_delta)
	dcdb  = current_length * (5.28524e-06 * pow(act_width,0.3631) * exp(-0.0496802 * (act_in_up + 48.8448)) + 0.5 * 4.43153e-08 * act_delta)
    }   
    if (C < 0) {
	C = 0
    }
    if (didm1 < 0) {
	didm1 = 0
    }	
    if (THK_D_ACT_XCALIBRATE__M2 > 0 ) {
	bval = lookup1 ("THICKNESS_D_ACT",layer1(), corner,act_width, act_distance)
        bmax = lookup1 ("THICKNESS_D_ACT",layer1(), corner, max_calwidth, max_caldistance)
    } else {	
	bval = lookup1 ("THICKNESS_D",layer1(), corner,current_width, dist)
        bmax = lookup1 ("THICKNESS_D",layer1(), corner,max_calwidth, max_caldistance)
    }	
    if (PLATE_LOADING > 0) {
	    C = C - (didm1 * dm1val) - (dcdb * bval) - 0.5 * (bval - bmax) * LOADING_FACTOR * current_length * current_width * 4.43153e-08
    } else {
	    C = C - (didm1 * dm1val) - (dcdb * bval) - 0.5 * bval * current_length * current_width * 4.43153e-08
    }
    C = C * scaleunits
]

#ENDCRYPT


#ENCRYPT
//
//  model: 37  target: nearbody  profile: ultra layers: ultra_base,XCALIBRATE__M1,XCALIBRATE__M2
//
CAPACITANCE NEARBODY XCALIBRATE__M2 INSIDE OF XCALIBRATE__M1 MASK
[
    PROPERTY C
    max_calwidth = 60 // For reference
    max_caldistance = 1206 // For reference
    min_calwidth = 12 // For reference
    min_caldistance = 8 // For reference
    max_width = MAXWIDTH_XCALIBRATE__M2
    max_distance = MAXDISTANCE_XCALIBRATE__M2
    max_radius = MAXRADIUS_XCALIBRATE__M2
    height = 0.5
    scaleunits = 1e-15/1e-15
    profile = ultra_profileid
    dt(1) = {0}
    dtval = get_value ("dt", corner_index())
    cor_thickness = lookup1 ("NOM_THICKNESS",layer1(), corner_index(), -1, -1)
    dtindie = thickness1() - cor_thickness
    distanceb = distance_behind() - width1()
    if (MULTI_BIAS_XCALIBRATE__M2 > 0 ) {
    	act_delta_right = lookup1 (bias1_tbl(),layer1(), corner_index(), width1(), distance())
    	act_delta_left = lookup1 (bias1_tbl(),layer1(), corner_index(), width1(), distanceb)
    	act_delta = lookup1 (bias1_tbl(),layer1(), corner_index(), width2(), distance())
    	act_width1 = width1() + (act_delta_left + act_delta_right)
    	act_width2 = width2() + 2 * act_delta
    	act_distance1 = distance() - (act_delta_right + act_delta)
    	act_distanceb = distanceb - 2 * act_delta_left 
    	act_delta_right = lookup1 (bias2_tbl(),layer1(), corner_index(), act_width1, act_distance1)
    	act_delta_left = lookup1 (bias2_tbl(),layer1(), corner_index(), act_width1, act_distanceb)
    	act_delta = lookup1 (bias2_tbl(),layer1(), corner_index(), act_width2, act_distance1)
    	act_distance = act_distance1 - (act_delta_right + act_delta) 
    	act_width12 = act_width1 + (act_delta_left + act_delta_right)
    	act_width22 = act_width2 + 2 * act_delta
    	act_width = 2 * act_width12 * act_width22 / (act_width12 + act_width22)
    } else {
    	act_delta_right = lookup1 (delta_tbl(),layer1(), corner_index(), width1(), distance())
    	act_delta_left = lookup1 (delta_tbl(),layer1(), corner_index(), width1(), distanceb)
    	act_delta = lookup1 (delta_tbl(),layer1(), corner_index(), width2(), distance())
    	act_width1 = width1() + 0.5 * (act_delta_left + act_delta_right)
    	act_width2 = width2() + act_delta
    	act_distance = distance() - 0.5 * (act_delta_right + act_delta)
    	act_width = 2 * act_width1 * act_width2 / (act_width1 + act_width2)
    }
    if ( mask_offset() != -1 ) { 
        act_distance = act_distance + mask_offset()
    } 
    if (act_distance < min_caldistance) {
	act_distance = min_caldistance	
    }
    if (act_width < min_calwidth) {
	act_width = min_calwidth	
    }
    nval = 0 
    sval = 0 
    if ( PEX_USE_K_VARIATION > 0 ) { 
 	if ( PEX_XCALIBRATE__M2_USE_SIDEWALL_K_VARIATION > 0 ) { 
 	   if ( mask_offset() == -1 ) { 
	      if (PEX_XCALIBRATE__M2_SIDEWALL_K_DRAWN > 0) {
	         nval = lookup1 ("SIDEWALL_K",layer1(), 0, width1(), distance()) 
 	         sval = lookup1 ("SIDEWALL_K",layer1(), corner_index(),width1(), distance()) 
	      } else { 
 	         nval = lookup1 ("SIDEWALL_K_ACT",layer1(), 0, act_width, act_distance) 
  	         sval = lookup1 ("SIDEWALL_K_ACT",layer1(), corner_index(),act_width, act_distance) 
	      } 
 	      dtindie  = dtindie + thickness1() * ((sval/nval) - 1) 
	   } 
        } 
    } 
    model = 37
    model = 43
    sf4r1 = (1 - m37RS * exp((-m43nbk1 * radius_down()) / (m43nbk2 * act_distance + m43nbk3 * height)))
    sf4r2 = (1 - m37RS * exp((-m43nbk4 * radius_up()) / (m43nbk5 * act_distance + m43nbk6 * height))) 
    sf4 = m37NB_COEF * sf4r1 * sf4r2
    model = 7
    current_length = length()
    
        nb = (0.00360352*exp(-0.159554 * act_distance) + 0.00753778 * pow(act_distance , -0.805124)) * pow(act_width , 0.384564)
    dndt = ((0.00905687*exp(-0.361188 * act_distance ) + 0.0181705 * pow(act_distance,-0.937508))*pow(act_width, 0.0681781))
    C = current_length * nb * sf4
    

    if(sf4 >= 1 && distance_shield() > 0 ) {
    	nbr = 1
        if (nbr < 0.97 ) {
	    nbr = 0.97
	} else if ( nbr > 1 ) {
	    nbr = 1
	}
    	C = C * nbr
    }
    dndt = current_length * dndt 
    C = C + dndt * (dtval + dtindie)
    
    C = C * scaleunits
]

#ENDCRYPT


#ENCRYPT
//
//  model: 37  target: crossovere  profile: ultra layers: ultra_base,XCALIBRATE__M1,XCALIBRATE__M2
//
CAPACITANCE CROSSOVER FRINGE XCALIBRATE__M2 XCALIBRATE__M1 MASK
[
    PROPERTY C
    max_calwidth = 60 // For reference
    max_caldistance = 1206 // For reference
    max2_calwidth = 28 // For reference
    max2_caldistance = 644.266 // For reference
    min_calwidth = 12 // For reference
    min_caldistance = 8 // For reference
    max_calenclose = 1206 // For reference
    max_calrad1 = 12.0104 // For reference
    max_width = MAXWIDTH_XCALIBRATE__M2
    max_distance = MAXDISTANCE_XCALIBRATE__M2
    max_enclose = MAXENCLOSE_XCALIBRATE__M2
    max_radius = MAXRADIUS_XCALIBRATE__M2
    height = 0.5
    scaleunits = 1e-15/1e-15
    profile = ultra_profileid
    dm1(1) = {0}
    dm1val = get_value ("dm1", corner_index())
    if (distance() <= 0.0) {
	dist = max_caldistance
    } else {
	dist = distance()
    }
    distb = distance_behind() - width()
    if (MULTI_BIAS_XCALIBRATE__M2 > 0 ) {
    	act_delta_right = lookup1 (bias1_tbl(),layer1(), corner_index(), width(), dist)
    	act_delta_left = lookup1 (bias1_tbl(),layer1(), corner_index(), width(), distb)
    	act_delta2 = lookup1 (bias1_tbl(),layer1(), corner_index(), width2(), dist)
    	act_delta = (act_delta_left + act_delta_right)
    	act_width1 = width() + act_delta
    	act_enclose = enclose() - act_delta_right
    	act_width2 = width2() + 2 * act_delta2
    	act_dist = dist - (act_delta_right + act_delta2)
    	act_distb = distb - 2 * act_delta_left 
    	act_delta_right = lookup1 (bias2_tbl(),layer1(), corner_index(), act_width1, act_dist)
    	act_delta_left = lookup1 (bias2_tbl(),layer1(), corner_index(), act_width1, act_distb)
    	act_delta2 = lookup1 (bias2_tbl(),layer1(), corner_index(), act_width2, act_dist)
    	act_enclose = act_enclose - act_delta_right
    	act_width = act_width1 + (act_delta_left + act_delta_right)
    	act_distance = act_dist - (act_delta_right + act_delta2) 
    	act_delta = act_delta + (act_delta_left + act_delta_right)	
    } else {
    	act_delta_right = lookup1 (delta_tbl(),layer1(), corner_index(), width(), dist)
    	act_delta_left = lookup1 (delta_tbl(),layer1(), corner_index(), width(), distb)
    	act_delta2 = lookup1 (delta_tbl(),layer1(), corner_index(), width2(), dist)
    	act_delta = 0.5 * (act_delta_left + act_delta_right)
   	act_enclose = enclose() - 0.5 * act_delta_right
        act_width = width() + act_delta 
        act_distance = dist - 0.5 * (act_delta_right + act_delta2)
    }
 	if ( mask_offset() != -1 ) { 
    act_distance = act_distance + mask_offset()
	} 
    nrval = 0 
    nlval = 0 
    rval = 0 
    lval = 0 
    if ( PEX_USE_K_VARIATION > 0 ) { 
 	if ( PEX_XCALIBRATE__M2_USE_BOTTOM_K_VARIATION > 0 ) { 
	nrval = lookup1 ("BOTTOM_K",layer1(), 0,width(), dist) 
 	nlval = lookup1 ("BOTTOM_K",layer1(), 0,width(), distb) 
 	rval = lookup1 ("BOTTOM_K",layer1(), corner_index(),width(), dist) 
 	lval = lookup1 ("BOTTOM_K",layer1(), corner_index(),width(), distb) 
	act_width  = act_width + width()*((rval+lval)/(nrval+nlval)-1) 
    } 
	} 
    if (act_distance < min_caldistance) {
	act_distance = min_caldistance
    }
    if (act_width < min_calwidth) {
	act_width = min_calwidth
    }
    act_width_max = act_width
    if (act_width > max_calwidth) {
	act_width_max = max_calwidth
    }
    if (act_enclose < 0) {
	act_enclose = 0
    }
    model = 37
    C = 0.0
    dcdm1 = 0.0
    dcdb  = 0.0
    sf4r1 = (1 - m37RS * exp((-m43ink1 * radius_down()) / (m43ink2 * act_distance + m43ink3 * height))) 
    sf0r1 = (1 - m37RS * exp((-m43ink1 * radius_down()) / (m43ink2 * max_caldistance + m43ink3 * height)))
    sf4r2 = (1 - m37RS * exp((-m43ink4 * radius_up()) / (m43ink5 * act_distance + m43ink6 * height))) 
    sf0r2 = (1 - m37RS * exp((-m43ink4 * radius_up()) / (m43ink5 * max_caldistance + m43ink6 * height)))
    sf4 = m37IN_COEF * sf4r1 * sf4r2
    sf0 = m37IN0_COEF * sf0r1 * sf0r2
    if ((distance() > 0.0) && (same_net() == 0) && (enclose() >= max_enclose)) {
	 model = 7
	 model = 43
	   if(act_distance >= 1208.78 ) {
				max_thr_distance = 1208.78 
				value1 = (0.0372721 * (1 - exp(-0.343815 * (max2_caldistance + 1.53903))) * pow(act_width , 0.00262298 * max2_caldistance + 0.0732523))
				value2 = (0.0372721 * (1 - exp(-0.343815 * (max_caldistance + 1.53903))) * pow(act_width , 0.00262298 * max_caldistance + 0.0732523))
	  			cr = value1 - (value2 - value1) * ((max2_caldistance - act_distance) / (max2_caldistance - max_caldistance))
				dcdm1 = (0.00434389 * (1 - exp(-130.823 * max_thr_distance - 93.3807 * act_width)) * pow(act_width, -0.00141015 * max_thr_distance + 0.650742) )
				dcdb = (75.5174 * (1 - exp(-1.81788e-05 * max_thr_distance - 9.78283e-06 * act_width)) * pow(act_width, -0.00987747 * max_thr_distance + 0.104129) )
			}
			else if(act_width >= 600 )   {
				max_thr_width = 600 
				value1 = (0.0372721 * (1 - exp(-0.343815 * (act_distance + 1.53903))) * pow(max2_calwidth , 0.00262298 * act_distance + 0.0732523))
				value2 = (0.0372721 * (1 - exp(-0.343815 * (act_distance + 1.53903))) * pow(max_calwidth , 0.00262298 * act_distance + 0.0732523))
				cr = value1 - (value2 - value1) * ((max2_calwidth - act_width) / (max2_calwidth- max_calwidth))
				dcdm1 = (0.00434389 * (1 - exp(-130.823 * act_distance - 93.3807 * act_width)) * pow(max_thr_width, -0.00141015 * act_distance + 0.650742) )
				dcdb = (75.5174 * (1 - exp(-1.81788e-05 * act_distance - 9.78283e-06 * act_width)) * pow(max_thr_width, -0.00987747 * act_distance + 0.104129) )
			}
			else {
				cr = (0.0372721 * (1 - exp(-0.343815 * (act_distance + 1.53903))) * pow(act_width , 0.00262298 * act_distance + 0.0732523))
				dcdm1 = (0.00434389 * (1 - exp(-130.823 * act_distance - 93.3807 * act_width)) * pow(act_width, -0.00141015 * act_distance + 0.650742) )
				dcdb = (75.5174 * (1 - exp(-1.81788e-05 * act_distance - 9.78283e-06 * act_width)) * pow(act_width, -0.00987747 * act_distance + 0.104129) )
			}
    	C = length() * ( cr + 0.5 * 0.0548955 * act_delta) * sf4
    	dcdm1 = length() * ( dcdm1 + 0.5 * 0.110062 * act_delta) 
	dcdb = length() * ( dcdb + 0.5 * 0.110062 * act_delta) 
    }
    if ((distance() > 0.0) && (enclose() < max_enclose) && (enclose() >= distance())) {
	 model = 7	
	   if(act_distance >= 1208.78 ) {
				max_thr_distance = 1208.78 
				value1 = (0.0372721 * (1 - exp(-0.343815 * (max2_caldistance + 1.53903))) * pow(act_width , 0.00262298 * max2_caldistance + 0.0732523))
				value2 = (0.0372721 * (1 - exp(-0.343815 * (max_caldistance + 1.53903))) * pow(act_width , 0.00262298 * max_caldistance + 0.0732523))
	  			cr = value1 - (value2 - value1) * ((max2_caldistance - act_distance) / (max2_caldistance - max_caldistance))
				dcdm1 = (0.00434389 * (1 - exp(-130.823 * max_thr_distance - 93.3807 * act_width)) * pow(act_width, -0.00141015 * max_thr_distance + 0.650742) )
				dcdb = (75.5174 * (1 - exp(-1.81788e-05 * max_thr_distance - 9.78283e-06 * act_width)) * pow(act_width, -0.00987747 * max_thr_distance + 0.104129) )
			}
			else if(act_width >= 600 )   {
				max_thr_width = 600 
				value1 = (0.0372721 * (1 - exp(-0.343815 * (act_distance + 1.53903))) * pow(max2_calwidth , 0.00262298 * act_distance + 0.0732523))
				value2 = (0.0372721 * (1 - exp(-0.343815 * (act_distance + 1.53903))) * pow(max_calwidth , 0.00262298 * act_distance + 0.0732523))
				cr = value1 - (value2 - value1) * ((max2_calwidth - act_width) / (max2_calwidth- max_calwidth))
				dcdm1 = (0.00434389 * (1 - exp(-130.823 * act_distance - 93.3807 * act_width)) * pow(max_thr_width, -0.00141015 * act_distance + 0.650742) )
				dcdb = (75.5174 * (1 - exp(-1.81788e-05 * act_distance - 9.78283e-06 * act_width)) * pow(max_thr_width, -0.00987747 * act_distance + 0.104129) )
			}
			else {
				cr = (0.0372721 * (1 - exp(-0.343815 * (act_distance + 1.53903))) * pow(act_width , 0.00262298 * act_distance + 0.0732523))
				dcdm1 = (0.00434389 * (1 - exp(-130.823 * act_distance - 93.3807 * act_width)) * pow(act_width, -0.00141015 * act_distance + 0.650742) )
				dcdb = (75.5174 * (1 - exp(-1.81788e-05 * act_distance - 9.78283e-06 * act_width)) * pow(act_width, -0.00987747 * act_distance + 0.104129) )
			}
    	C = length() * ( cr + 0.5 * 0.0548955 * act_delta) * sf4
    	dcdm1 = length() * ( dcdm1 + 0.5 * 0.110062 * act_delta) 
	dcdb = length() * ( dcdb + 0.5 * 0.110062 * act_delta) 
    }
    if ((distance() > 0.0) && (same_net() == 1) && (enclose() >= max_enclose)) {
	model = 40
	model = 43
        C = length() * (0.0532216 * (1 - exp(-0.110353 * (act_distance + 9.94646))) + 0.5 * 0.0548955 * act_delta) * sf4
    }
    if ((distance() <= 0.0) && (enclose() >= max_enclose)) {
	model = 9
	model = 43
        C = length() * (0.0380547 * pow(act_width , 0.120777) + 0.5 * 0.0548955 * act_delta) * sf0 
	dcdm1 = length() * (0.00931507 * pow(act_width , 0.343231) + 0.5 * 0.110062 * act_delta)
	dcdb = (0.00931507 * pow(act_width_max , 0.343231))  
	dcdb = length() * ( dcdb + 0.5 * 0.110062 * act_delta)
    }
    if ((distance() > 0.0) && (enclose() < max_enclose) && (enclose() < distance()) && (enclose() > 0)) {
 	model = 27
	model = 43
        C = length() * ((0.5 * (1.26689e-06 * act_distance + 0.13925) * (0.730652 - exp(-(0.000298032 * act_distance + 0.300875) * (act_enclose + -0.00207985 * act_distance + 3.66996) - (0.000214105 * act_distance + -0.0227502) * (act_enclose + 0.0011227 * act_distance + 0.00560536) * (act_enclose + 0.0011227 * act_distance + 0.00560536)))) + 0.5 * 0.0548955 * act_delta) * sf4
    }
    if ((distance() > 0.0) && (enclose() <= 0)) {
 	model = 27
	model = 43
         C = length() * (0.5 * (1.26689e-06 * act_distance + 0.13925) * (0.730652 - exp(-(0.000298032 * act_distance + 0.300875) * (act_enclose + -0.00207985 * act_distance + 3.66996) - (0.000214105 * act_distance + -0.0227502) * (act_enclose + 0.0011227 * act_distance + 0.00560536) * (act_enclose + 0.0011227 * act_distance + 0.00560536))) + 0.5 * 0.0548955 * act_delta) * sf4
    }
    if ((distance() <= 0.0) && (enclose() < max_enclose) && (enclose() > 0)) {
	model = 1
	model = 43
        cal_max = 5 * min_calwidth
	if (act_enclose > cal_max) {
	    act_enclose = cal_max
	}
	if (act_enclose < 5 && (radius_down_behind() >= max_calrad1)) {
	    act_enclose = 5
	}
	if (act_enclose < 0.8 && (radius_down_behind() < max_calrad1)) {
	    act_enclose = 0.8
	}
        C = length() * ((0.0379883 * (1 - exp(-0.478911 * (act_enclose + 1.97551))) * pow(act_width , 0.0001314 * act_enclose + 0.112124)) + 0.5 * 0.0548955 * act_delta) * sf0
    }
    if ((distance() <= 0.0) && (enclose() <= 0)) {
	model = 1
	model = 43
        C = length() * ((0.0379883 * (1 - exp(-0.478911 * (act_enclose + 1.97551))) * pow(act_width , 0.0001314 * act_enclose + 0.112124)) + 0.5 * 0.0548955 * act_delta) * sf0
    }
    if (C < 0.0) {
        C = 0
    }
    if (dcdm1 < 0.0) {
        dcdm1 = 0
    }
    if (dcdb < 0.0) {
        dcdb = 0
    }
    if (THK_D_ACT_XCALIBRATE__M2 > 0 ) {
	bval = lookup1 ("THICKNESS_D_ACT",layer1(), corner_index(),act_width, act_distance)
        bmax = lookup1 ("THICKNESS_D_ACT",layer1(), corner_index(), max_calwidth, max_caldistance)
    } else {	
	bval = lookup1 ("THICKNESS_D",layer1(), corner_index(),width(), dist)
        bmax = lookup1 ("THICKNESS_D",layer1(), corner_index(),max_calwidth, max_caldistance)
    }	
    if (PLATE_LOADING > 0) {
	C = C - (dcdm1 * dm1val) - (dcdb * bval) - 0.5 * (bval - bmax) * LOADING_FACTOR * length() * width() * 0.110062
    } else {
    	C = C - (dcdm1 * dm1val) - (dcdb * bval) - 0.5 * bval * length() * width() * 0.110062
    }
    if (C < 0) {
	C = 0
    }
    C = C * scaleunits
]

#ENDCRYPT


#ENCRYPT
//
//  model: 37  target: nearbody  profile: ultra layers: ultra_base,XCALIBRATE__M1,XCALIBRATE__MC
//
CAPACITANCE NEARBODY XCALIBRATE__MC INSIDE OF XCALIBRATE__M1 MASK
[
    PROPERTY C
    max_calwidth = 60 // For reference
    max_caldistance = 1202.5 // For reference
    min_calwidth = 12 // For reference
    min_caldistance = 8 // For reference
    max_width = MAXWIDTH_XCALIBRATE__MC
    max_distance = MAXDISTANCE_XCALIBRATE__MC
    max_radius = MAXRADIUS_XCALIBRATE__MC
    height = 0.92
    scaleunits = 1e-15/1e-15
    profile = ultra_profileid
    dt(1) = {0}
    dtval = get_value ("dt", corner_index())
    cor_thickness = lookup1 ("NOM_THICKNESS",layer1(), corner_index(), -1, -1)
    dtindie = thickness1() - cor_thickness
    distanceb = distance_behind() - width1()
    if (MULTI_BIAS_XCALIBRATE__MC > 0 ) {
    	act_delta_right = lookup1 (bias1_tbl(),layer1(), corner_index(), width1(), distance())
    	act_delta_left = lookup1 (bias1_tbl(),layer1(), corner_index(), width1(), distanceb)
    	act_delta = lookup1 (bias1_tbl(),layer1(), corner_index(), width2(), distance())
    	act_width1 = width1() + (act_delta_left + act_delta_right)
    	act_width2 = width2() + 2 * act_delta
    	act_distance1 = distance() - (act_delta_right + act_delta)
    	act_distanceb = distanceb - 2 * act_delta_left 
    	act_delta_right = lookup1 (bias2_tbl(),layer1(), corner_index(), act_width1, act_distance1)
    	act_delta_left = lookup1 (bias2_tbl(),layer1(), corner_index(), act_width1, act_distanceb)
    	act_delta = lookup1 (bias2_tbl(),layer1(), corner_index(), act_width2, act_distance1)
    	act_distance = act_distance1 - (act_delta_right + act_delta) 
    	act_width12 = act_width1 + (act_delta_left + act_delta_right)
    	act_width22 = act_width2 + 2 * act_delta
    	act_width = 2 * act_width12 * act_width22 / (act_width12 + act_width22)
    } else {
    	act_delta_right = lookup1 (delta_tbl(),layer1(), corner_index(), width1(), distance())
    	act_delta_left = lookup1 (delta_tbl(),layer1(), corner_index(), width1(), distanceb)
    	act_delta = lookup1 (delta_tbl(),layer1(), corner_index(), width2(), distance())
    	act_width1 = width1() + 0.5 * (act_delta_left + act_delta_right)
    	act_width2 = width2() + act_delta
    	act_distance = distance() - 0.5 * (act_delta_right + act_delta)
    	act_width = 2 * act_width1 * act_width2 / (act_width1 + act_width2)
    }
    if ( mask_offset() != -1 ) { 
        act_distance = act_distance + mask_offset()
    } 
    if (act_distance < min_caldistance) {
	act_distance = min_caldistance	
    }
    if (act_width < min_calwidth) {
	act_width = min_calwidth	
    }
    nval = 0 
    sval = 0 
    if ( PEX_USE_K_VARIATION > 0 ) { 
 	if ( PEX_XCALIBRATE__MC_USE_SIDEWALL_K_VARIATION > 0 ) { 
 	   if ( mask_offset() == -1 ) { 
	      if (PEX_XCALIBRATE__MC_SIDEWALL_K_DRAWN > 0) {
	         nval = lookup1 ("SIDEWALL_K",layer1(), 0, width1(), distance()) 
 	         sval = lookup1 ("SIDEWALL_K",layer1(), corner_index(),width1(), distance()) 
	      } else { 
 	         nval = lookup1 ("SIDEWALL_K_ACT",layer1(), 0, act_width, act_distance) 
  	         sval = lookup1 ("SIDEWALL_K_ACT",layer1(), corner_index(),act_width, act_distance) 
	      } 
 	      dtindie  = dtindie + thickness1() * ((sval/nval) - 1) 
	   } 
        } 
    } 
    model = 37
    model = 43
    sf4r1 = (1 - m37RS * exp((-m43nbk1 * radius_down()) / (m43nbk2 * act_distance + m43nbk3 * height)))
    sf4r2 = (1 - m37RS * exp((-m43nbk4 * radius_up()) / (m43nbk5 * act_distance + m43nbk6 * height))) 
    sf4 = m37NB_COEF * sf4r1 * sf4r2
    model = 7
    current_length = length()
    
        nb = (0.00357679*exp(-0.124287 * act_distance) + 0.011083 * pow(act_distance , -1.00298)) * pow(act_width , 0.376174)
    dndt = ((0.00396563*exp(-0.108569 * act_distance ) + 0.0368559 * pow(act_distance,-1.44079))*pow(act_width, 0.0599014))
    C = current_length * nb * sf4
    

    if(sf4 >= 1 && distance_shield() > 0 ) {
    	nbr = 1
        if (nbr < 0.97 ) {
	    nbr = 0.97
	} else if ( nbr > 1 ) {
	    nbr = 1
	}
    	C = C * nbr
    }
    dndt = current_length * dndt 
    C = C + dndt * (dtval + dtindie)
    
    C = C * scaleunits
]

#ENDCRYPT


#ENCRYPT
//
//  model: 37  target: crossovere  profile: ultra layers: ultra_base,XCALIBRATE__M1,XCALIBRATE__MC
//
CAPACITANCE CROSSOVER FRINGE XCALIBRATE__MC XCALIBRATE__M1 MASK
[
    PROPERTY C
    max_calwidth = 60 // For reference
    max_caldistance = 1202.5 // For reference
    max2_calwidth = 28 // For reference
    max2_caldistance = 642.63 // For reference
    min_calwidth = 12 // For reference
    min_caldistance = 8 // For reference
    max_calenclose = 1202.5 // For reference
    max_calrad1 = 12.0037 // For reference
    max_width = MAXWIDTH_XCALIBRATE__MC
    max_distance = MAXDISTANCE_XCALIBRATE__MC
    max_enclose = MAXENCLOSE_XCALIBRATE__MC
    max_radius = MAXRADIUS_XCALIBRATE__MC
    height = 0.92
    scaleunits = 1e-15/1e-15
    profile = ultra_profileid
    dm1(1) = {0}
    dm1val = get_value ("dm1", corner_index())
    if (distance() <= 0.0) {
	dist = max_caldistance
    } else {
	dist = distance()
    }
    distb = distance_behind() - width()
    if (MULTI_BIAS_XCALIBRATE__MC > 0 ) {
    	act_delta_right = lookup1 (bias1_tbl(),layer1(), corner_index(), width(), dist)
    	act_delta_left = lookup1 (bias1_tbl(),layer1(), corner_index(), width(), distb)
    	act_delta2 = lookup1 (bias1_tbl(),layer1(), corner_index(), width2(), dist)
    	act_delta = (act_delta_left + act_delta_right)
    	act_width1 = width() + act_delta
    	act_enclose = enclose() - act_delta_right
    	act_width2 = width2() + 2 * act_delta2
    	act_dist = dist - (act_delta_right + act_delta2)
    	act_distb = distb - 2 * act_delta_left 
    	act_delta_right = lookup1 (bias2_tbl(),layer1(), corner_index(), act_width1, act_dist)
    	act_delta_left = lookup1 (bias2_tbl(),layer1(), corner_index(), act_width1, act_distb)
    	act_delta2 = lookup1 (bias2_tbl(),layer1(), corner_index(), act_width2, act_dist)
    	act_enclose = act_enclose - act_delta_right
    	act_width = act_width1 + (act_delta_left + act_delta_right)
    	act_distance = act_dist - (act_delta_right + act_delta2) 
    	act_delta = act_delta + (act_delta_left + act_delta_right)	
    } else {
    	act_delta_right = lookup1 (delta_tbl(),layer1(), corner_index(), width(), dist)
    	act_delta_left = lookup1 (delta_tbl(),layer1(), corner_index(), width(), distb)
    	act_delta2 = lookup1 (delta_tbl(),layer1(), corner_index(), width2(), dist)
    	act_delta = 0.5 * (act_delta_left + act_delta_right)
   	act_enclose = enclose() - 0.5 * act_delta_right
        act_width = width() + act_delta 
        act_distance = dist - 0.5 * (act_delta_right + act_delta2)
    }
 	if ( mask_offset() != -1 ) { 
    act_distance = act_distance + mask_offset()
	} 
    nrval = 0 
    nlval = 0 
    rval = 0 
    lval = 0 
    if ( PEX_USE_K_VARIATION > 0 ) { 
 	if ( PEX_XCALIBRATE__MC_USE_BOTTOM_K_VARIATION > 0 ) { 
	nrval = lookup1 ("BOTTOM_K",layer1(), 0,width(), dist) 
 	nlval = lookup1 ("BOTTOM_K",layer1(), 0,width(), distb) 
 	rval = lookup1 ("BOTTOM_K",layer1(), corner_index(),width(), dist) 
 	lval = lookup1 ("BOTTOM_K",layer1(), corner_index(),width(), distb) 
	act_width  = act_width + width()*((rval+lval)/(nrval+nlval)-1) 
    } 
	} 
    if (act_distance < min_caldistance) {
	act_distance = min_caldistance
    }
    if (act_width < min_calwidth) {
	act_width = min_calwidth
    }
    act_width_max = act_width
    if (act_width > max_calwidth) {
	act_width_max = max_calwidth
    }
    if (act_enclose < 0) {
	act_enclose = 0
    }
    model = 37
    C = 0.0
    dcdm1 = 0.0
    dcdb  = 0.0
    sf4r1 = (1 - m37RS * exp((-m43ink1 * radius_down()) / (m43ink2 * act_distance + m43ink3 * height))) 
    sf0r1 = (1 - m37RS * exp((-m43ink1 * radius_down()) / (m43ink2 * max_caldistance + m43ink3 * height)))
    sf4r2 = (1 - m37RS * exp((-m43ink4 * radius_up()) / (m43ink5 * act_distance + m43ink6 * height))) 
    sf0r2 = (1 - m37RS * exp((-m43ink4 * radius_up()) / (m43ink5 * max_caldistance + m43ink6 * height)))
    sf4 = m37IN_COEF * sf4r1 * sf4r2
    sf0 = m37IN0_COEF * sf0r1 * sf0r2
    if ((distance() > 0.0) && (same_net() == 0) && (enclose() >= max_enclose)) {
	 model = 7
	 model = 43
	   if(act_distance >= 1205.27 ) {
				max_thr_distance = 1205.27 
				value1 = (0.0298843 * (1 - exp(-0.166649 * (max2_caldistance + 3.75528))) * pow(act_width , 0.00037227 * max2_caldistance + 0.138442))
				value2 = (0.0298843 * (1 - exp(-0.166649 * (max_caldistance + 3.75528))) * pow(act_width , 0.00037227 * max_caldistance + 0.138442))
	  			cr = value1 - (value2 - value1) * ((max2_caldistance - act_distance) / (max2_caldistance - max_caldistance))
				dcdm1 = (27.9854 * (1 - exp(-1.57099e-06 * max_thr_distance - 4.43043e-05 * act_width)) * pow(act_width, -0.000890873 * max_thr_distance + -0.171149) )
				dcdb = (0.0013818 * (1 - exp(-1000 * max_thr_distance - 1000 * act_width)) * pow(act_width, -0.0006604 * max_thr_distance + 0.800144) )
			}
			else if(act_width >= 600 )   {
				max_thr_width = 600 
				value1 = (0.0298843 * (1 - exp(-0.166649 * (act_distance + 3.75528))) * pow(max2_calwidth , 0.00037227 * act_distance + 0.138442))
				value2 = (0.0298843 * (1 - exp(-0.166649 * (act_distance + 3.75528))) * pow(max_calwidth , 0.00037227 * act_distance + 0.138442))
				cr = value1 - (value2 - value1) * ((max2_calwidth - act_width) / (max2_calwidth- max_calwidth))
				dcdm1 = (27.9854 * (1 - exp(-1.57099e-06 * act_distance - 4.43043e-05 * act_width)) * pow(max_thr_width, -0.000890873 * act_distance + -0.171149) )
				dcdb = (0.0013818 * (1 - exp(-1000 * act_distance - 1000 * act_width)) * pow(max_thr_width, -0.0006604 * act_distance + 0.800144) )
			}
			else {
				cr = (0.0298843 * (1 - exp(-0.166649 * (act_distance + 3.75528))) * pow(act_width , 0.00037227 * act_distance + 0.138442))
				dcdm1 = (27.9854 * (1 - exp(-1.57099e-06 * act_distance - 4.43043e-05 * act_width)) * pow(act_width, -0.000890873 * act_distance + -0.171149) )
				dcdb = (0.0013818 * (1 - exp(-1000 * act_distance - 1000 * act_width)) * pow(act_width, -0.0006604 * act_distance + 0.800144) )
			}
    	C = length() * ( cr + 0.5 * 0.0298352 * act_delta) * sf4
    	dcdm1 = length() * ( dcdm1 + 0.5 * 0.0325107 * act_delta) 
	dcdb = length() * ( dcdb + 0.5 * 0.0325107 * act_delta) 
    }
    if ((distance() > 0.0) && (enclose() < max_enclose) && (enclose() >= distance())) {
	 model = 7	
	   if(act_distance >= 1205.27 ) {
				max_thr_distance = 1205.27 
				value1 = (0.0298843 * (1 - exp(-0.166649 * (max2_caldistance + 3.75528))) * pow(act_width , 0.00037227 * max2_caldistance + 0.138442))
				value2 = (0.0298843 * (1 - exp(-0.166649 * (max_caldistance + 3.75528))) * pow(act_width , 0.00037227 * max_caldistance + 0.138442))
	  			cr = value1 - (value2 - value1) * ((max2_caldistance - act_distance) / (max2_caldistance - max_caldistance))
				dcdm1 = (27.9854 * (1 - exp(-1.57099e-06 * max_thr_distance - 4.43043e-05 * act_width)) * pow(act_width, -0.000890873 * max_thr_distance + -0.171149) )
				dcdb = (0.0013818 * (1 - exp(-1000 * max_thr_distance - 1000 * act_width)) * pow(act_width, -0.0006604 * max_thr_distance + 0.800144) )
			}
			else if(act_width >= 600 )   {
				max_thr_width = 600 
				value1 = (0.0298843 * (1 - exp(-0.166649 * (act_distance + 3.75528))) * pow(max2_calwidth , 0.00037227 * act_distance + 0.138442))
				value2 = (0.0298843 * (1 - exp(-0.166649 * (act_distance + 3.75528))) * pow(max_calwidth , 0.00037227 * act_distance + 0.138442))
				cr = value1 - (value2 - value1) * ((max2_calwidth - act_width) / (max2_calwidth- max_calwidth))
				dcdm1 = (27.9854 * (1 - exp(-1.57099e-06 * act_distance - 4.43043e-05 * act_width)) * pow(max_thr_width, -0.000890873 * act_distance + -0.171149) )
				dcdb = (0.0013818 * (1 - exp(-1000 * act_distance - 1000 * act_width)) * pow(max_thr_width, -0.0006604 * act_distance + 0.800144) )
			}
			else {
				cr = (0.0298843 * (1 - exp(-0.166649 * (act_distance + 3.75528))) * pow(act_width , 0.00037227 * act_distance + 0.138442))
				dcdm1 = (27.9854 * (1 - exp(-1.57099e-06 * act_distance - 4.43043e-05 * act_width)) * pow(act_width, -0.000890873 * act_distance + -0.171149) )
				dcdb = (0.0013818 * (1 - exp(-1000 * act_distance - 1000 * act_width)) * pow(act_width, -0.0006604 * act_distance + 0.800144) )
			}
    	C = length() * ( cr + 0.5 * 0.0298352 * act_delta) * sf4
    	dcdm1 = length() * ( dcdm1 + 0.5 * 0.0325107 * act_delta) 
	dcdb = length() * ( dcdb + 0.5 * 0.0325107 * act_delta) 
    }
    if ((distance() > 0.0) && (same_net() == 1) && (enclose() >= max_enclose)) {
	model = 40
	model = 43
        C = length() * (0.0460121 * (1 - exp(-0.1092 * (act_distance + 7.85296))) + 0.5 * 0.0298352 * act_delta) * sf4
    }
    if ((distance() <= 0.0) && (enclose() >= max_enclose)) {
	model = 9
	model = 43
        C = length() * (0.0320912 * pow(act_width , 0.129111) + 0.5 * 0.0298352 * act_delta) * sf0 
	dcdm1 = length() * (0.00439322 * pow(act_width , 0.335095) + 0.5 * 0.0325107 * act_delta)
	dcdb = (0.00439322 * pow(act_width_max , 0.335095))  
	dcdb = length() * ( dcdb + 0.5 * 0.0325107 * act_delta)
    }
    if ((distance() > 0.0) && (enclose() < max_enclose) && (enclose() < distance()) && (enclose() > 0)) {
 	model = 27
	model = 43
        C = length() * ((0.5 * (1.43965e-06 * act_distance + 0.130605) * (0.669048 - exp(-(0.000541239 * act_distance + 0.250727) * (act_enclose + -0.00407182 * act_distance + 4.25605) - (0.000146546 * act_distance + -0.0161437) * (act_enclose + 0.00249316 * act_distance + 0.40946) * (act_enclose + 0.00249316 * act_distance + 0.40946)))) + 0.5 * 0.0298352 * act_delta) * sf4
    }
    if ((distance() > 0.0) && (enclose() <= 0)) {
 	model = 27
	model = 43
         C = length() * (0.5 * (1.43965e-06 * act_distance + 0.130605) * (0.669048 - exp(-(0.000541239 * act_distance + 0.250727) * (act_enclose + -0.00407182 * act_distance + 4.25605) - (0.000146546 * act_distance + -0.0161437) * (act_enclose + 0.00249316 * act_distance + 0.40946) * (act_enclose + 0.00249316 * act_distance + 0.40946))) + 0.5 * 0.0298352 * act_delta) * sf4
    }
    if ((distance() <= 0.0) && (enclose() < max_enclose) && (enclose() > 0)) {
	model = 1
	model = 43
        cal_max = 5 * min_calwidth
	if (act_enclose > cal_max) {
	    act_enclose = cal_max
	}
	if (act_enclose < 5 && (radius_down_behind() >= max_calrad1)) {
	    act_enclose = 5
	}
	if (act_enclose < 0.8 && (radius_down_behind() < max_calrad1)) {
	    act_enclose = 0.8
	}
        C = length() * ((0.0319604 * (1 - exp(-0.412971 * (act_enclose + 2.28907))) * pow(act_width , 0.000146226 * act_enclose + 0.119648)) + 0.5 * 0.0298352 * act_delta) * sf0
    }
    if ((distance() <= 0.0) && (enclose() <= 0)) {
	model = 1
	model = 43
        C = length() * ((0.0319604 * (1 - exp(-0.412971 * (act_enclose + 2.28907))) * pow(act_width , 0.000146226 * act_enclose + 0.119648)) + 0.5 * 0.0298352 * act_delta) * sf0
    }
    if (C < 0.0) {
        C = 0
    }
    if (dcdm1 < 0.0) {
        dcdm1 = 0
    }
    if (dcdb < 0.0) {
        dcdb = 0
    }
    if (THK_D_ACT_XCALIBRATE__MC > 0 ) {
	bval = lookup1 ("THICKNESS_D_ACT",layer1(), corner_index(),act_width, act_distance)
        bmax = lookup1 ("THICKNESS_D_ACT",layer1(), corner_index(), max_calwidth, max_caldistance)
    } else {	
	bval = lookup1 ("THICKNESS_D",layer1(), corner_index(),width(), dist)
        bmax = lookup1 ("THICKNESS_D",layer1(), corner_index(),max_calwidth, max_caldistance)
    }	
    if (PLATE_LOADING > 0) {
	C = C - (dcdm1 * dm1val) - (dcdb * bval) - 0.5 * (bval - bmax) * LOADING_FACTOR * length() * width() * 0.0325107
    } else {
    	C = C - (dcdm1 * dm1val) - (dcdb * bval) - 0.5 * bval * length() * width() * 0.0325107
    }
    if (C < 0) {
	C = 0
    }
    C = C * scaleunits
]

#ENDCRYPT


#ENCRYPT
//
//  model: 37  target: nearbody  profile: ultra layers: ultra_base,XCALIBRATE__M2,XCALIBRATE__MC
//
CAPACITANCE NEARBODY XCALIBRATE__MC INSIDE OF XCALIBRATE__M2 MASK
[
    PROPERTY C
    max_calwidth = 60 // For reference
    max_caldistance = 1202.5 // For reference
    min_calwidth = 12 // For reference
    min_caldistance = 8 // For reference
    max_width = MAXWIDTH_XCALIBRATE__MC
    max_distance = MAXDISTANCE_XCALIBRATE__MC
    max_radius = MAXRADIUS_XCALIBRATE__MC
    height = 0.3
    scaleunits = 1e-15/1e-15
    profile = ultra_profileid
    dt(1) = {0}
    dtval = get_value ("dt", corner_index())
    cor_thickness = lookup1 ("NOM_THICKNESS",layer1(), corner_index(), -1, -1)
    dtindie = thickness1() - cor_thickness
    distanceb = distance_behind() - width1()
    if (MULTI_BIAS_XCALIBRATE__MC > 0 ) {
    	act_delta_right = lookup1 (bias1_tbl(),layer1(), corner_index(), width1(), distance())
    	act_delta_left = lookup1 (bias1_tbl(),layer1(), corner_index(), width1(), distanceb)
    	act_delta = lookup1 (bias1_tbl(),layer1(), corner_index(), width2(), distance())
    	act_width1 = width1() + (act_delta_left + act_delta_right)
    	act_width2 = width2() + 2 * act_delta
    	act_distance1 = distance() - (act_delta_right + act_delta)
    	act_distanceb = distanceb - 2 * act_delta_left 
    	act_delta_right = lookup1 (bias2_tbl(),layer1(), corner_index(), act_width1, act_distance1)
    	act_delta_left = lookup1 (bias2_tbl(),layer1(), corner_index(), act_width1, act_distanceb)
    	act_delta = lookup1 (bias2_tbl(),layer1(), corner_index(), act_width2, act_distance1)
    	act_distance = act_distance1 - (act_delta_right + act_delta) 
    	act_width12 = act_width1 + (act_delta_left + act_delta_right)
    	act_width22 = act_width2 + 2 * act_delta
    	act_width = 2 * act_width12 * act_width22 / (act_width12 + act_width22)
    } else {
    	act_delta_right = lookup1 (delta_tbl(),layer1(), corner_index(), width1(), distance())
    	act_delta_left = lookup1 (delta_tbl(),layer1(), corner_index(), width1(), distanceb)
    	act_delta = lookup1 (delta_tbl(),layer1(), corner_index(), width2(), distance())
    	act_width1 = width1() + 0.5 * (act_delta_left + act_delta_right)
    	act_width2 = width2() + act_delta
    	act_distance = distance() - 0.5 * (act_delta_right + act_delta)
    	act_width = 2 * act_width1 * act_width2 / (act_width1 + act_width2)
    }
    if ( mask_offset() != -1 ) { 
        act_distance = act_distance + mask_offset()
    } 
    if (act_distance < min_caldistance) {
	act_distance = min_caldistance	
    }
    if (act_width < min_calwidth) {
	act_width = min_calwidth	
    }
    nval = 0 
    sval = 0 
    if ( PEX_USE_K_VARIATION > 0 ) { 
 	if ( PEX_XCALIBRATE__MC_USE_SIDEWALL_K_VARIATION > 0 ) { 
 	   if ( mask_offset() == -1 ) { 
	      if (PEX_XCALIBRATE__MC_SIDEWALL_K_DRAWN > 0) {
	         nval = lookup1 ("SIDEWALL_K",layer1(), 0, width1(), distance()) 
 	         sval = lookup1 ("SIDEWALL_K",layer1(), corner_index(),width1(), distance()) 
	      } else { 
 	         nval = lookup1 ("SIDEWALL_K_ACT",layer1(), 0, act_width, act_distance) 
  	         sval = lookup1 ("SIDEWALL_K_ACT",layer1(), corner_index(),act_width, act_distance) 
	      } 
 	      dtindie  = dtindie + thickness1() * ((sval/nval) - 1) 
	   } 
        } 
    } 
    model = 37
    model = 43
    sf4r1 = (1 - m37RS * exp((-m43nbk1 * radius_down()) / (m43nbk2 * act_distance + m43nbk3 * height)))
    sf4r2 = (1 - m37RS * exp((-m43nbk4 * radius_up()) / (m43nbk5 * act_distance + m43nbk6 * height))) 
    sf4 = m37NB_COEF * sf4r1 * sf4r2
    model = 7
    current_length = length()
    
        nb = (0.00232662*exp(-0.126934 * act_distance) + 0.00669746 * pow(act_distance , -0.960768)) * pow(act_width , 0.441987)
    dndt = ((0.00371705*exp(-0.116208 * act_distance ) + 0.0284193 * pow(act_distance,-1.39654))*pow(act_width, 0.0843067))
    C = current_length * nb * sf4
    

    if(sf4 >= 1 && distance_shield() > 0 ) {
    	nbr = 1
        if (nbr < 0.97 ) {
	    nbr = 0.97
	} else if ( nbr > 1 ) {
	    nbr = 1
	}
    	C = C * nbr
    }
    dndt = current_length * dndt 
    C = C + dndt * (dtval + dtindie)
    
    C = C * scaleunits
]

#ENDCRYPT


#ENCRYPT
//
//  model: 37  target: crossovere  profile: ultra layers: ultra_base,XCALIBRATE__M2,XCALIBRATE__MC
//
CAPACITANCE CROSSOVER FRINGE XCALIBRATE__MC XCALIBRATE__M2 MASK
[
    PROPERTY C
    max_calwidth = 60 // For reference
    max_caldistance = 1202.5 // For reference
    max2_calwidth = 28 // For reference
    max2_caldistance = 642.63 // For reference
    min_calwidth = 12 // For reference
    min_caldistance = 8 // For reference
    max_calenclose = 1202.5 // For reference
    max_calrad1 = 12.0037 // For reference
    max_width = MAXWIDTH_XCALIBRATE__MC
    max_distance = MAXDISTANCE_XCALIBRATE__MC
    max_enclose = MAXENCLOSE_XCALIBRATE__MC
    max_radius = MAXRADIUS_XCALIBRATE__MC
    height = 0.3
    scaleunits = 1e-15/1e-15
    profile = ultra_profileid
    dm1(1) = {0}
    dm1val = get_value ("dm1", corner_index())
    if (distance() <= 0.0) {
	dist = max_caldistance
    } else {
	dist = distance()
    }
    distb = distance_behind() - width()
    if (MULTI_BIAS_XCALIBRATE__MC > 0 ) {
    	act_delta_right = lookup1 (bias1_tbl(),layer1(), corner_index(), width(), dist)
    	act_delta_left = lookup1 (bias1_tbl(),layer1(), corner_index(), width(), distb)
    	act_delta2 = lookup1 (bias1_tbl(),layer1(), corner_index(), width2(), dist)
    	act_delta = (act_delta_left + act_delta_right)
    	act_width1 = width() + act_delta
    	act_enclose = enclose() - act_delta_right
    	act_width2 = width2() + 2 * act_delta2
    	act_dist = dist - (act_delta_right + act_delta2)
    	act_distb = distb - 2 * act_delta_left 
    	act_delta_right = lookup1 (bias2_tbl(),layer1(), corner_index(), act_width1, act_dist)
    	act_delta_left = lookup1 (bias2_tbl(),layer1(), corner_index(), act_width1, act_distb)
    	act_delta2 = lookup1 (bias2_tbl(),layer1(), corner_index(), act_width2, act_dist)
    	act_enclose = act_enclose - act_delta_right
    	act_width = act_width1 + (act_delta_left + act_delta_right)
    	act_distance = act_dist - (act_delta_right + act_delta2) 
    	act_delta = act_delta + (act_delta_left + act_delta_right)	
    } else {
    	act_delta_right = lookup1 (delta_tbl(),layer1(), corner_index(), width(), dist)
    	act_delta_left = lookup1 (delta_tbl(),layer1(), corner_index(), width(), distb)
    	act_delta2 = lookup1 (delta_tbl(),layer1(), corner_index(), width2(), dist)
    	act_delta = 0.5 * (act_delta_left + act_delta_right)
   	act_enclose = enclose() - 0.5 * act_delta_right
        act_width = width() + act_delta 
        act_distance = dist - 0.5 * (act_delta_right + act_delta2)
    }
 	if ( mask_offset() != -1 ) { 
    act_distance = act_distance + mask_offset()
	} 
    nrval = 0 
    nlval = 0 
    rval = 0 
    lval = 0 
    if ( PEX_USE_K_VARIATION > 0 ) { 
 	if ( PEX_XCALIBRATE__MC_USE_BOTTOM_K_VARIATION > 0 ) { 
	nrval = lookup1 ("BOTTOM_K",layer1(), 0,width(), dist) 
 	nlval = lookup1 ("BOTTOM_K",layer1(), 0,width(), distb) 
 	rval = lookup1 ("BOTTOM_K",layer1(), corner_index(),width(), dist) 
 	lval = lookup1 ("BOTTOM_K",layer1(), corner_index(),width(), distb) 
	act_width  = act_width + width()*((rval+lval)/(nrval+nlval)-1) 
    } 
	} 
    if (act_distance < min_caldistance) {
	act_distance = min_caldistance
    }
    if (act_width < min_calwidth) {
	act_width = min_calwidth
    }
    act_width_max = act_width
    if (act_width > max_calwidth) {
	act_width_max = max_calwidth
    }
    if (act_enclose < 0) {
	act_enclose = 0
    }
    model = 37
    C = 0.0
    dcdm1 = 0.0
    dcdb  = 0.0
    sf4r1 = (1 - m37RS * exp((-m43ink1 * radius_down()) / (m43ink2 * act_distance + m43ink3 * height))) 
    sf0r1 = (1 - m37RS * exp((-m43ink1 * radius_down()) / (m43ink2 * max_caldistance + m43ink3 * height)))
    sf4r2 = (1 - m37RS * exp((-m43ink4 * radius_up()) / (m43ink5 * act_distance + m43ink6 * height))) 
    sf0r2 = (1 - m37RS * exp((-m43ink4 * radius_up()) / (m43ink5 * max_caldistance + m43ink6 * height)))
    sf4 = m37IN_COEF * sf4r1 * sf4r2
    sf0 = m37IN0_COEF * sf0r1 * sf0r2
    if ((distance() > 0.0) && (same_net() == 0) && (enclose() >= max_enclose)) {
	 model = 7
	 model = 43
	   if(act_distance >= 10865.3 ) {
				max_thr_distance = 10865.3 
				value1 = (0.0333446 * (1 - exp(-0.178123 * (max2_caldistance + 6.0833))) * pow(act_width , 0.000214011 * max2_caldistance + 0.196531))
				value2 = (0.0333446 * (1 - exp(-0.178123 * (max_caldistance + 6.0833))) * pow(act_width , 0.000214011 * max_caldistance + 0.196531))
	  			cr = value1 - (value2 - value1) * ((max2_caldistance - act_distance) / (max2_caldistance - max_caldistance))
				dcdm1 = (0.00186365 * (1 - exp(-5.81695 * max_thr_distance - 12.1429 * act_width)) * pow(act_width, -0.000129521 * max_thr_distance + 1.14324) )
				dcdb = (393.869 * (1 - exp(-3.82598e-07 * max_thr_distance - 3.50532e-06 * act_width)) * pow(act_width, -0.000688725 * max_thr_distance + 0.219288) )
			}
			else {
				cr = (0.0333446 * (1 - exp(-0.178123 * (act_distance + 6.0833))) * pow(act_width , 0.000214011 * act_distance + 0.196531))
				dcdm1 = (0.00186365 * (1 - exp(-5.81695 * act_distance - 12.1429 * act_width)) * pow(act_width, -0.000129521 * act_distance + 1.14324) )
				dcdb = (393.869 * (1 - exp(-3.82598e-07 * act_distance - 3.50532e-06 * act_width)) * pow(act_width, -0.000688725 * act_distance + 0.219288) )
			}
    	C = length() * ( cr + 0.5 * 0.091496 * act_delta) * sf4
    	dcdm1 = length() * ( dcdm1 + 0.5 * 0.30575 * act_delta) 
	dcdb = length() * ( dcdb + 0.5 * 0.30575 * act_delta) 
    }
    if ((distance() > 0.0) && (enclose() < max_enclose) && (enclose() >= distance())) {
	 model = 7	
	   if(act_distance >= 10865.3 ) {
				max_thr_distance = 10865.3 
				value1 = (0.0333446 * (1 - exp(-0.178123 * (max2_caldistance + 6.0833))) * pow(act_width , 0.000214011 * max2_caldistance + 0.196531))
				value2 = (0.0333446 * (1 - exp(-0.178123 * (max_caldistance + 6.0833))) * pow(act_width , 0.000214011 * max_caldistance + 0.196531))
	  			cr = value1 - (value2 - value1) * ((max2_caldistance - act_distance) / (max2_caldistance - max_caldistance))
				dcdm1 = (0.00186365 * (1 - exp(-5.81695 * max_thr_distance - 12.1429 * act_width)) * pow(act_width, -0.000129521 * max_thr_distance + 1.14324) )
				dcdb = (393.869 * (1 - exp(-3.82598e-07 * max_thr_distance - 3.50532e-06 * act_width)) * pow(act_width, -0.000688725 * max_thr_distance + 0.219288) )
			}
			else {
				cr = (0.0333446 * (1 - exp(-0.178123 * (act_distance + 6.0833))) * pow(act_width , 0.000214011 * act_distance + 0.196531))
				dcdm1 = (0.00186365 * (1 - exp(-5.81695 * act_distance - 12.1429 * act_width)) * pow(act_width, -0.000129521 * act_distance + 1.14324) )
				dcdb = (393.869 * (1 - exp(-3.82598e-07 * act_distance - 3.50532e-06 * act_width)) * pow(act_width, -0.000688725 * act_distance + 0.219288) )
			}
    	C = length() * ( cr + 0.5 * 0.091496 * act_delta) * sf4
    	dcdm1 = length() * ( dcdm1 + 0.5 * 0.30575 * act_delta) 
	dcdb = length() * ( dcdb + 0.5 * 0.30575 * act_delta) 
    }
    if ((distance() > 0.0) && (same_net() == 1) && (enclose() >= max_enclose)) {
	model = 40
	model = 43
        C = length() * (0.0583135 * (1 - exp(-0.111222 * (act_distance + 11.8441))) + 0.5 * 0.091496 * act_delta) * sf4
    }
    if ((distance() <= 0.0) && (enclose() >= max_enclose)) {
	model = 9
	model = 43
        C = length() * (0.0364848 * pow(act_width , 0.168911) + 0.5 * 0.091496 * act_delta) * sf0 
	dcdm1 = length() * (0.00613557 * pow(act_width , 0.723273) + 0.5 * 0.30575 * act_delta)
	dcdb = (0.00613557 * pow(act_width_max , 0.723273))  
	dcdb = length() * ( dcdb + 0.5 * 0.30575 * act_delta)
    }
    if ((distance() > 0.0) && (enclose() < max_enclose) && (enclose() < distance()) && (enclose() > 0)) {
 	model = 27
	model = 43
        C = length() * ((0.5 * (1.06982e-06 * act_distance + 0.132917) * (0.832323 - exp(-(-8.67678e-05 * act_distance + 0.356623) * (act_enclose + 0.00052061 * act_distance + 2.91834) - (0.000298112 * act_distance + -0.0306614) * (act_enclose + -0.000261394 * act_distance + -0.341138) * (act_enclose + -0.000261394 * act_distance + -0.341138)))) + 0.5 * 0.091496 * act_delta) * sf4
    }
    if ((distance() > 0.0) && (enclose() <= 0)) {
 	model = 27
	model = 43
         C = length() * (0.5 * (1.06982e-06 * act_distance + 0.132917) * (0.832323 - exp(-(-8.67678e-05 * act_distance + 0.356623) * (act_enclose + 0.00052061 * act_distance + 2.91834) - (0.000298112 * act_distance + -0.0306614) * (act_enclose + -0.000261394 * act_distance + -0.341138) * (act_enclose + -0.000261394 * act_distance + -0.341138))) + 0.5 * 0.091496 * act_delta) * sf4
    }
    if ((distance() <= 0.0) && (enclose() < max_enclose) && (enclose() > 0)) {
	model = 1
	model = 43
        cal_max = 5 * min_calwidth
	if (act_enclose > cal_max) {
	    act_enclose = cal_max
	}
	if (act_enclose < 5 && (radius_down_behind() >= max_calrad1)) {
	    act_enclose = 5
	}
	if (act_enclose < 0.8 && (radius_down_behind() < max_calrad1)) {
	    act_enclose = 0.8
	}
        C = length() * ((0.0357946 * (1 - exp(-0.527039 * (act_enclose + 1.70567))) * pow(act_width , 9.98764e-05 * act_enclose + 0.169458)) + 0.5 * 0.091496 * act_delta) * sf0
    }
    if ((distance() <= 0.0) && (enclose() <= 0)) {
	model = 1
	model = 43
        C = length() * ((0.0357946 * (1 - exp(-0.527039 * (act_enclose + 1.70567))) * pow(act_width , 9.98764e-05 * act_enclose + 0.169458)) + 0.5 * 0.091496 * act_delta) * sf0
    }
    if (C < 0.0) {
        C = 0
    }
    if (dcdm1 < 0.0) {
        dcdm1 = 0
    }
    if (dcdb < 0.0) {
        dcdb = 0
    }
    if (THK_D_ACT_XCALIBRATE__MC > 0 ) {
	bval = lookup1 ("THICKNESS_D_ACT",layer1(), corner_index(),act_width, act_distance)
        bmax = lookup1 ("THICKNESS_D_ACT",layer1(), corner_index(), max_calwidth, max_caldistance)
    } else {	
	bval = lookup1 ("THICKNESS_D",layer1(), corner_index(),width(), dist)
        bmax = lookup1 ("THICKNESS_D",layer1(), corner_index(),max_calwidth, max_caldistance)
    }	
    if (PLATE_LOADING > 0) {
	C = C - (dcdm1 * dm1val) - (dcdb * bval) - 0.5 * (bval - bmax) * LOADING_FACTOR * length() * width() * 0.30575
    } else {
    	C = C - (dcdm1 * dm1val) - (dcdb * bval) - 0.5 * bval * length() * width() * 0.30575
    }
    if (C < 0) {
	C = 0
    }
    C = C * scaleunits
]

#ENDCRYPT


#ENCRYPT
//
//  model: 35  target: intrinsic  profile: ultra layers: ultra_base,XCALIBRATE__M1,XCALIBRATE__M2
//
CAPACITANCE INTRINSIC FRINGE XCALIBRATE__M2 INSIDE OF XCALIBRATE__M1 MASK
[
    PROPERTY C
    max_calwidth = 60 // For reference
    max_caldistance = 1206 // For reference
    min_calwidth = 12 // For reference
    min_caldistance = 8 // For reference
    max_width = MAXWIDTH_XCALIBRATE__M2
    max_distance = MAXDISTANCE_XCALIBRATE__M2
    max_enclose = MAXENCLOSE_XCALIBRATE__M2
    scaleunits = 1e-15/1e-15 
    profile = ultra_profileid
    model = 35	
    act_delta = lookup1 (delta_tbl(),layer1(), corner_index(), width(), distance())
    act_width = width() + act_delta 
    act_distance = distance() - act_delta 
    act_in_down = inside_down() - act_delta / 2.0
    if (act_distance < min_caldistance) {
	act_distance = min_caldistance	
    }
    if (act_width < min_calwidth) {
	act_width = min_calwidth	
    }
    if (act_in_down < 0) {
	act_in_down = 0
    }
    C = 0.0
    if (distance() > 0.0) {
	model = 27
        C = length() * 0.5 * 0.190329 * exp(-0.139432 * act_in_down) * (0.0585323 - 0.0600024 * exp(-0.000919002 * act_distance) * pow(act_distance , -0.115748))
    }
    if (distance() <= 0.0) {
	model = 1
        C = length() * 0.5 * (0.00406212 * exp(-0.118588 * act_in_down) + 0.00638516 * exp(-0.380945 * act_in_down)) * pow(act_width , 0.0252272 * act_in_down + 0.0268848)
    }
    if (C < 0) {
	C = 0
    }
    C = C * scaleunits
]

#ENDCRYPT


#ENCRYPT
//
//  model: 35  target: intrinsic  profile: ultra layers: ultra_base,XCALIBRATE__M1,XCALIBRATE__MC
//
CAPACITANCE INTRINSIC FRINGE XCALIBRATE__MC INSIDE OF XCALIBRATE__M1 MASK
[
    PROPERTY C
    max_calwidth = 60 // For reference
    max_caldistance = 1202.5 // For reference
    min_calwidth = 12 // For reference
    min_caldistance = 8 // For reference
    max_width = MAXWIDTH_XCALIBRATE__MC
    max_distance = MAXDISTANCE_XCALIBRATE__MC
    max_enclose = MAXENCLOSE_XCALIBRATE__MC
    scaleunits = 1e-15/1e-15 
    profile = ultra_profileid
    model = 35	
    act_delta = lookup1 (delta_tbl(),layer1(), corner_index(), width(), distance())
    act_width = width() + act_delta 
    act_distance = distance() - act_delta 
    act_in_down = inside_down() - act_delta / 2.0
    if (act_distance < min_caldistance) {
	act_distance = min_caldistance	
    }
    if (act_width < min_calwidth) {
	act_width = min_calwidth	
    }
    if (act_in_down < 0) {
	act_in_down = 0
    }
    C = 0.0
    if (distance() > 0.0) {
	model = 27
        C = length() * 0.5 * 0.190271 * exp(-0.128303 * act_in_down) * (0.0596593 - 0.0612167 * exp(-0.000891184 * act_distance) * pow(act_distance , -0.123167))
    }
    if (distance() <= 0.0) {
	model = 1
        C = length() * 0.5 * (0.00431771 * exp(-0.110233 * act_in_down) + 0.00682315 * exp(-0.344435 * act_in_down)) * pow(act_width , 0.0234156 * act_in_down + 0.0284714)
    }
    if (C < 0) {
	C = 0
    }
    C = C * scaleunits
]

#ENDCRYPT


#ENCRYPT
//
//  model: 35  target: intrinsic  profile: ultra layers: ultra_base,XCALIBRATE__M2,XCALIBRATE__MC
//
CAPACITANCE INTRINSIC FRINGE XCALIBRATE__MC INSIDE OF XCALIBRATE__M2 MASK
[
    PROPERTY C
    max_calwidth = 60 // For reference
    max_caldistance = 1202.5 // For reference
    min_calwidth = 12 // For reference
    min_caldistance = 8 // For reference
    max_width = MAXWIDTH_XCALIBRATE__MC
    max_distance = MAXDISTANCE_XCALIBRATE__MC
    max_enclose = MAXENCLOSE_XCALIBRATE__MC
    scaleunits = 1e-15/1e-15 
    profile = ultra_profileid
    model = 35	
    act_delta = lookup1 (delta_tbl(),layer1(), corner_index(), width(), distance())
    act_width = width() + act_delta 
    act_distance = distance() - act_delta 
    act_in_down = inside_down() - act_delta / 2.0
    if (act_distance < min_caldistance) {
	act_distance = min_caldistance	
    }
    if (act_width < min_calwidth) {
	act_width = min_calwidth	
    }
    if (act_in_down < 0) {
	act_in_down = 0
    }
    C = 0.0
    if (distance() > 0.0) {
	model = 27
        C = length() * 0.5 * 0.202622 * exp(-0.151695 * act_in_down) * (0.0593723 - 0.0619807 * exp(-0.000743428 * act_distance) * pow(act_distance , -0.127979))
    }
    if (distance() <= 0.0) {
	model = 1
        C = length() * 0.5 * (0.00446195 * exp(-0.127474 * act_in_down) + 0.00710627 * exp(-0.414591 * act_in_down)) * pow(act_width , 0.0274006 * act_in_down + 0.0227791)
    }
    if (C < 0) {
	C = 0
    }
    C = C * scaleunits
]

#ENDCRYPT

